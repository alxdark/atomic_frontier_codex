!function(){var a=!0;!function(b){var c=this||(0,eval)("this"),d=c.document,e=c.navigator,f=c.jQuery,g=c.JSON;!function(a){if("function"==typeof require&&"object"==typeof exports&&"object"==typeof module){var b=module.exports||exports;a(b)}else"function"==typeof define&&define.amd?define(["exports"],a):a(c.ko={})}(function(h){function i(a,b){var c=null===a||typeof a in n;return c?a===b:!1}function j(a){var b=this;return a&&m.utils.objectForEach(a,function(a,c){var d=m.extenders[a];"function"==typeof d&&(b=d(b,c)||b)}),b}function k(a){m.bindingHandlers[a]={init:function(b,c,d,e,f){var g=function(){var b={};return b[a]=c(),b};return m.bindingHandlers.event.init.call(this,b,g,d,e,f)}}}function l(a,b,c,d){m.bindingHandlers[a]={init:function(a){return m.utils.domData.set(a,w,{}),{controlsDescendantBindings:!0}},update:function(a,e,f,g,h){var i=m.utils.domData.get(a,w),j=m.utils.unwrapObservable(e()),k=!c!=!j,l=!i.savedNodes,n=l||b||k!==i.didDisplayOnLastUpdate;n&&(l&&(i.savedNodes=m.utils.cloneNodes(m.virtualElements.childNodes(a),!0)),k?(l||m.virtualElements.setDomNodeChildren(a,m.utils.cloneNodes(i.savedNodes)),m.applyBindingsToDescendants(d?d(h,j):h,a)):m.virtualElements.emptyNode(a),i.didDisplayOnLastUpdate=k)}},m.expressionRewriting.bindingRewriteValidators[a]=!1,m.virtualElements.allowedBindings[a]=!0}var m="undefined"!=typeof h?h:{};m.exportSymbol=function(a,b){for(var c=a.split("."),d=m,e=0;e<c.length-1;e++)d=d[c[e]];d[c[c.length-1]]=b},m.exportProperty=function(a,b,c){a[b]=c},m.version="3.0.0",m.exportSymbol("version",m.version),m.utils=function(){function a(a,b){if("input"!==m.utils.tagNameLower(a)||!a.type)return!1;if("click"!=b.toLowerCase())return!1;var c=a.type;return"checkbox"==c||"radio"==c}var h=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])},i={},j={},k=e&&/Firefox\/2/i.test(e.userAgent)?"KeyboardEvent":"UIEvents";i[k]=["keyup","keydown","keypress"],i.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"],h(i,function(a,b){if(b.length)for(var c=0,d=b.length;d>c;c++)j[b[c]]=a});var l={propertychange:!0},n=d&&function(){for(var a=3,c=d.createElement("div"),e=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",e[0];);return a>4?a:b}(),o=6===n,p=7===n;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c])},arrayIndexOf:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},arrayFirst:function(a,b,c){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d]))return a[d];return null},arrayRemoveItem:function(a,b){var c=m.utils.arrayIndexOf(a,b);c>=0&&a.splice(c,1)},arrayGetDistinctValues:function(a){a=a||[];for(var b=[],c=0,d=a.length;d>c;c++)m.utils.arrayIndexOf(b,a[c])<0&&b.push(a[c]);return b},arrayMap:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d]));return c},arrayFilter:function(a,b){a=a||[];for(var c=[],d=0,e=a.length;e>d;d++)b(a[d])&&c.push(a[d]);return c},arrayPushAll:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;d>c;c++)a.push(b[c]);return a},addOrRemoveItem:function(a,b,c){var d=m.utils.arrayIndexOf(m.utils.peekObservable(a),b);0>d?c&&a.push(b):c||a.splice(d,1)},extend:function(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},objectForEach:h,objectMap:function(a,b){if(!a)return a;var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},emptyDomNode:function(a){for(;a.firstChild;)m.removeNode(a.firstChild)},moveCleanedNodesToContainerElement:function(a){for(var b=m.utils.makeArray(a),c=d.createElement("div"),e=0,f=b.length;f>e;e++)c.appendChild(m.cleanNode(b[e]));return c},cloneNodes:function(a,b){for(var c=0,d=a.length,e=[];d>c;c++){var f=a[c].cloneNode(!0);e.push(b?m.cleanNode(f):f)}return e},setDomNodeChildren:function(a,b){if(m.utils.emptyDomNode(a),b)for(var c=0,d=b.length;d>c;c++)a.appendChild(b[c])},replaceDomNodes:function(a,b){var c=a.nodeType?[a]:a;if(c.length>0){for(var d=c[0],e=d.parentNode,f=0,g=b.length;g>f;f++)e.insertBefore(b[f],d);for(var f=0,g=c.length;g>f;f++)m.removeNode(c[f])}},fixUpContinuousNodeArray:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);if(a.length>1){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)if(a.push(c),c=c.nextSibling,!c)return;a.push(d)}}return a},setOptionNodeSelectionState:function(a,b){7>n?a.setAttribute("selected",b):a.selected=b},stringTrim:function(a){return null===a||a===b?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},stringTokenize:function(a,b){for(var c=[],d=(a||"").split(b),e=0,f=d.length;f>e;e++){var g=m.utils.stringTrim(d[e]);""!==g&&c.push(g)}return c},stringStartsWith:function(a,b){return a=a||"",b.length>a.length?!1:a.substring(0,b.length)===b},domNodeIsContainedBy:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(16&b.compareDocumentPosition(a));for(;a&&a!=b;)a=a.parentNode;return!!a},domNodeIsAttachedToDocument:function(a){return m.utils.domNodeIsContainedBy(a,a.ownerDocument.documentElement)},anyDomNodeIsAttachedToDocument:function(a){return!!m.utils.arrayFirst(a,m.utils.domNodeIsAttachedToDocument)},tagNameLower:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},registerEventHandler:function(b,c,d){var e=n&&l[c];if(e||"undefined"==typeof f)if(e||"function"!=typeof b.addEventListener){if("undefined"==typeof b.attachEvent)throw new Error("Browser doesn't support addEventListener or attachEvent");var g=function(a){d.call(b,a)},h="on"+c;b.attachEvent(h,g),m.utils.domNodeDisposal.addDisposeCallback(b,function(){b.detachEvent(h,g)})}else b.addEventListener(c,d,!1);else{if(a(b,c)){var i=d;d=function(a,b){var c=this.checked;b&&(this.checked=b.checkedStateBeforeEvent!==!0),i.call(this,a),this.checked=c}}f(b).bind(c,d)}},triggerEvent:function(b,e){if(!b||!b.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");if("undefined"!=typeof f){var g=[];a(b,e)&&g.push({checkedStateBeforeEvent:b.checked}),f(b).trigger(e,g)}else if("function"==typeof d.createEvent){if("function"!=typeof b.dispatchEvent)throw new Error("The supplied element doesn't support dispatchEvent");var h=j[e]||"HTMLEvents",i=d.createEvent(h);i.initEvent(e,!0,!0,c,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(i)}else{if("undefined"==typeof b.fireEvent)throw new Error("Browser doesn't support triggering events");a(b,e)&&(b.checked=b.checked!==!0),b.fireEvent("on"+e)}},unwrapObservable:function(a){return m.isObservable(a)?a():a},peekObservable:function(a){return m.isObservable(a)?a.peek():a},toggleDomNodeCssClass:function(a,b,c){if(b){var d=/\S+/g,e=a.className.match(d)||[];m.utils.arrayForEach(b.match(d),function(a){m.utils.addOrRemoveItem(e,a,c)}),a.className=e.join(" ")}},setTextContent:function(a,c){var e=m.utils.unwrapObservable(c);(null===e||e===b)&&(e="");var f=m.virtualElements.firstChild(a);!f||3!=f.nodeType||m.virtualElements.nextSibling(f)?m.virtualElements.setDomNodeChildren(a,[d.createTextNode(e)]):f.data=e,m.utils.forceRefresh(a)},setElementName:function(a,b){if(a.name=b,7>=n)try{a.mergeAttributes(d.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}},forceRefresh:function(a){if(n>=9){var b=1==a.nodeType?a:a.parentNode;b.style&&(b.style.zoom=b.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(a){if(n){var b=a.style.width;a.style.width=0,a.style.width=b}},range:function(a,b){a=m.utils.unwrapObservable(a),b=m.utils.unwrapObservable(b);for(var c=[],d=a;b>=d;d++)c.push(d);return c},makeArray:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},isIe6:o,isIe7:p,ieVersion:n,getFormFields:function(a,b){for(var c=m.utils.makeArray(a.getElementsByTagName("input")).concat(m.utils.makeArray(a.getElementsByTagName("textarea"))),d="string"==typeof b?function(a){return a.name===b}:function(a){return b.test(a.name)},e=[],f=c.length-1;f>=0;f--)d(c[f])&&e.push(c[f]);return e},parseJson:function(a){return"string"==typeof a&&(a=m.utils.stringTrim(a))?g&&g.parse?g.parse(a):new Function("return "+a)():null},stringifyJson:function(a,b,c){if(!g||!g.stringify)throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return g.stringify(m.utils.unwrapObservable(a),b,c)},postJson:function(a,b,c){c=c||{};var e=c.params||{},f=c.includeFields||this.fieldsIncludedWithJsonPost,g=a;if("object"==typeof a&&"form"===m.utils.tagNameLower(a)){var i=a;g=i.action;for(var j=f.length-1;j>=0;j--)for(var k=m.utils.getFormFields(i,f[j]),l=k.length-1;l>=0;l--)e[k[l].name]=k[l].value}b=m.utils.unwrapObservable(b);var n=d.createElement("form");n.style.display="none",n.action=g,n.method="post";for(var o in b){var p=d.createElement("input");p.name=o,p.value=m.utils.stringifyJson(m.utils.unwrapObservable(b[o])),n.appendChild(p)}h(e,function(a,b){var c=d.createElement("input");c.name=a,c.value=b,n.appendChild(c)}),d.body.appendChild(n),c.submitter?c.submitter(n):n.submit(),setTimeout(function(){n.parentNode.removeChild(n)},0)}}}(),m.exportSymbol("utils",m.utils),m.exportSymbol("utils.arrayForEach",m.utils.arrayForEach),m.exportSymbol("utils.arrayFirst",m.utils.arrayFirst),m.exportSymbol("utils.arrayFilter",m.utils.arrayFilter),m.exportSymbol("utils.arrayGetDistinctValues",m.utils.arrayGetDistinctValues),m.exportSymbol("utils.arrayIndexOf",m.utils.arrayIndexOf),m.exportSymbol("utils.arrayMap",m.utils.arrayMap),m.exportSymbol("utils.arrayPushAll",m.utils.arrayPushAll),m.exportSymbol("utils.arrayRemoveItem",m.utils.arrayRemoveItem),m.exportSymbol("utils.extend",m.utils.extend),m.exportSymbol("utils.fieldsIncludedWithJsonPost",m.utils.fieldsIncludedWithJsonPost),m.exportSymbol("utils.getFormFields",m.utils.getFormFields),m.exportSymbol("utils.peekObservable",m.utils.peekObservable),m.exportSymbol("utils.postJson",m.utils.postJson),m.exportSymbol("utils.parseJson",m.utils.parseJson),m.exportSymbol("utils.registerEventHandler",m.utils.registerEventHandler),m.exportSymbol("utils.stringifyJson",m.utils.stringifyJson),m.exportSymbol("utils.range",m.utils.range),m.exportSymbol("utils.toggleDomNodeCssClass",m.utils.toggleDomNodeCssClass),m.exportSymbol("utils.triggerEvent",m.utils.triggerEvent),m.exportSymbol("utils.unwrapObservable",m.utils.unwrapObservable),m.exportSymbol("utils.objectForEach",m.utils.objectForEach),m.exportSymbol("utils.addOrRemoveItem",m.utils.addOrRemoveItem),m.exportSymbol("unwrap",m.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice.call(arguments),a=c.shift();return function(){return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}),m.utils.domData=new function(){function a(a,f){var g=a[d],h=g&&"null"!==g&&e[g];if(!h){if(!f)return b;g=a[d]="ko"+c++,e[g]={}}return e[g]}var c=0,d="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===b?b:e[d]},set:function(c,d,e){if(e!==b||a(c,!1)!==b){var f=a(c,!0);f[d]=e}},clear:function(a){var b=a[d];return b?(delete e[b],a[d]=null,!0):!1},nextKey:function(){return c++ +d}}},m.exportSymbol("utils.domData",m.utils.domData),m.exportSymbol("utils.domData.clear",m.utils.domData.clear),m.utils.domNodeDisposal=new function(){function a(a,c){var d=m.utils.domData.get(a,g);return d===b&&c&&(d=[],m.utils.domData.set(a,g,d)),d}function c(a){m.utils.domData.set(a,g,b)}function d(b){var c=a(b,!1);if(c){c=c.slice(0);for(var d=0;d<c.length;d++)c[d](b)}m.utils.domData.clear(b),"function"==typeof f&&"function"==typeof f.cleanData&&f.cleanData([b]),i[b.nodeType]&&e(b)}function e(a){for(var b,c=a.firstChild;b=c;)c=b.nextSibling,8===b.nodeType&&d(b)}var g=m.utils.domData.nextKey(),h={1:!0,8:!0,9:!0},i={1:!0,9:!0};return{addDisposeCallback:function(b,c){if("function"!=typeof c)throw new Error("Callback must be a function");a(b,!0).push(c)},removeDisposeCallback:function(b,d){var e=a(b,!1);e&&(m.utils.arrayRemoveItem(e,d),0==e.length&&c(b))},cleanNode:function(a){if(h[a.nodeType]&&(d(a),i[a.nodeType])){var b=[];m.utils.arrayPushAll(b,a.getElementsByTagName("*"));for(var c=0,e=b.length;e>c;c++)d(b[c])}return a},removeNode:function(a){m.cleanNode(a),a.parentNode&&a.parentNode.removeChild(a)}}},m.cleanNode=m.utils.domNodeDisposal.cleanNode,m.removeNode=m.utils.domNodeDisposal.removeNode,m.exportSymbol("cleanNode",m.cleanNode),m.exportSymbol("removeNode",m.removeNode),m.exportSymbol("utils.domNodeDisposal",m.utils.domNodeDisposal),m.exportSymbol("utils.domNodeDisposal.addDisposeCallback",m.utils.domNodeDisposal.addDisposeCallback),m.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",m.utils.domNodeDisposal.removeDisposeCallback),function(){function a(a){var b=m.utils.stringTrim(a).toLowerCase(),e=d.createElement("div"),f=b.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!b.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!b.indexOf("<td")||!b.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],g="ignored<div>"+f[1]+a+f[2]+"</div>";for("function"==typeof c.innerShiv?e.appendChild(c.innerShiv(g)):e.innerHTML=g;f[0]--;)e=e.lastChild;return m.utils.makeArray(e.lastChild.childNodes)}function e(a){if(f.parseHTML)return f.parseHTML(a)||[];var b=f.clean([a]);if(b&&b[0]){for(var c=b[0];c.parentNode&&11!==c.parentNode.nodeType;)c=c.parentNode;c.parentNode&&c.parentNode.removeChild(c)}return b}m.utils.parseHtmlFragment=function(b){return"undefined"!=typeof f?e(b):a(b)},m.utils.setHtml=function(a,c){if(m.utils.emptyDomNode(a),c=m.utils.unwrapObservable(c),null!==c&&c!==b)if("string"!=typeof c&&(c=c.toString()),"undefined"!=typeof f)f(a).html(c);else for(var d=m.utils.parseHtmlFragment(c),e=0;e<d.length;e++)a.appendChild(d[e])}}(),m.exportSymbol("utils.parseHtmlFragment",m.utils.parseHtmlFragment),m.exportSymbol("utils.setHtml",m.utils.setHtml),m.memoization=function(){function a(){return(0|4294967296*(1+Math.random())).toString(16).substring(1)}function c(){return a()+a()}function d(a,b){if(a)if(8==a.nodeType){var c=m.memoization.parseMemoText(a.nodeValue);null!=c&&b.push({domNode:a,memoId:c})}else if(1==a.nodeType)for(var e=0,f=a.childNodes,g=f.length;g>e;e++)d(f[e],b)}var e={};return{memoize:function(a){if("function"!=typeof a)throw new Error("You can only pass a function to ko.memoization.memoize()");var b=c();return e[b]=a,"<!--[ko_memo:"+b+"]-->"},unmemoize:function(a,c){var d=e[a];if(d===b)throw new Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return d.apply(null,c||[]),!0}finally{delete e[a]}},unmemoizeDomNodeAndDescendants:function(a,b){var c=[];d(a,c);for(var e=0,f=c.length;f>e;e++){var g=c[e].domNode,h=[g];b&&m.utils.arrayPushAll(h,b),m.memoization.unmemoize(c[e].memoId,h),g.nodeValue="",g.parentNode&&g.parentNode.removeChild(g)}},parseMemoText:function(a){var b=a.match(/^\[ko_memo\:(.*?)\]$/);return b?b[1]:null}}}(),m.exportSymbol("memoization",m.memoization),m.exportSymbol("memoization.memoize",m.memoization.memoize),m.exportSymbol("memoization.unmemoize",m.memoization.unmemoize),m.exportSymbol("memoization.parseMemoText",m.memoization.parseMemoText),m.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",m.memoization.unmemoizeDomNodeAndDescendants),m.extenders={throttle:function(a,b){a.throttleEvaluation=b;var c=null;return m.dependentObservable({read:a,write:function(d){clearTimeout(c),c=setTimeout(function(){a(d)},b)}})},notify:function(a,b){a.equalityComparer="always"==b?null:i}};var n={undefined:1,"boolean":1,number:1,string:1};m.exportSymbol("extenders",m.extenders),m.subscription=function(a,b,c){this.target=a,this.callback=b,this.disposeCallback=c,m.exportProperty(this,"dispose",this.dispose)},m.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},m.subscribable=function(){this._subscriptions={},m.utils.extend(this,m.subscribable.fn),m.exportProperty(this,"subscribe",this.subscribe),m.exportProperty(this,"extend",this.extend),m.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var o="change";m.subscribable.fn={subscribe:function(a,b,c){c=c||o;var d=b?a.bind(b):a,e=new m.subscription(this,d,function(){m.utils.arrayRemoveItem(this._subscriptions[c],e)}.bind(this));return this._subscriptions[c]||(this._subscriptions[c]=[]),this._subscriptions[c].push(e),e},notifySubscribers:function(a,b){if(b=b||o,this.hasSubscriptionsForEvent(b))try{m.dependencyDetection.begin();for(var c,d=this._subscriptions[b].slice(0),e=0;c=d[e];++e)c&&c.isDisposed!==!0&&c.callback(a)}finally{m.dependencyDetection.end()}},hasSubscriptionsForEvent:function(a){return this._subscriptions[a]&&this._subscriptions[a].length},getSubscriptionsCount:function(){var a=0;return m.utils.objectForEach(this._subscriptions,function(b,c){a+=c.length}),a},extend:j},m.isSubscribable=function(a){return null!=a&&"function"==typeof a.subscribe&&"function"==typeof a.notifySubscribers},m.exportSymbol("subscribable",m.subscribable),m.exportSymbol("isSubscribable",m.isSubscribable),m.dependencyDetection=function(){var a=[];return{begin:function(b){a.push(b&&{callback:b,distinctDependencies:[]})},end:function(){a.pop()},registerDependency:function(b){if(!m.isSubscribable(b))throw new Error("Only subscribable things can act as dependencies");if(a.length>0){var c=a[a.length-1];if(!c||m.utils.arrayIndexOf(c.distinctDependencies,b)>=0)return;c.distinctDependencies.push(b),c.callback(b)}},ignore:function(b,c,d){try{return a.push(null),b.apply(c,d||[])}finally{a.pop()}}}}(),m.observable=function(b){function c(){return arguments.length>0?(c.equalityComparer&&c.equalityComparer(d,arguments[0])||(c.valueWillMutate(),d=arguments[0],a&&(c._latestValue=d),c.valueHasMutated()),this):(m.dependencyDetection.registerDependency(c),d)}var d=b;return a&&(c._latestValue=d),m.subscribable.call(c),c.peek=function(){return d},c.valueHasMutated=function(){c.notifySubscribers(d)},c.valueWillMutate=function(){c.notifySubscribers(d,"beforeChange")},m.utils.extend(c,m.observable.fn),m.exportProperty(c,"peek",c.peek),m.exportProperty(c,"valueHasMutated",c.valueHasMutated),m.exportProperty(c,"valueWillMutate",c.valueWillMutate),c},m.observable.fn={equalityComparer:i};var p=m.observable.protoProperty="__ko_proto__";m.observable.fn[p]=m.observable,m.hasPrototype=function(a,c){return null===a||a===b||a[p]===b?!1:a[p]===c?!0:m.hasPrototype(a[p],c)},m.isObservable=function(a){return m.hasPrototype(a,m.observable)},m.isWriteableObservable=function(a){return"function"==typeof a&&a[p]===m.observable?!0:"function"==typeof a&&a[p]===m.dependentObservable&&a.hasWriteFunction?!0:!1},m.exportSymbol("observable",m.observable),m.exportSymbol("isObservable",m.isObservable),m.exportSymbol("isWriteableObservable",m.isWriteableObservable),m.observableArray=function(a){if(a=a||[],"object"!=typeof a||!("length"in a))throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");var b=m.observable(a);return m.utils.extend(b,m.observableArray.fn),b.extend({trackArrayChanges:!0})},m.observableArray.fn={remove:function(a){for(var b=this.peek(),c=[],d="function"!=typeof a||m.isObservable(a)?function(b){return b===a}:a,e=0;e<b.length;e++){var f=b[e];d(f)&&(0===c.length&&this.valueWillMutate(),c.push(f),b.splice(e,1),e--)}return c.length&&this.valueHasMutated(),c},removeAll:function(a){if(a===b){var c=this.peek(),d=c.slice(0);return this.valueWillMutate(),c.splice(0,c.length),this.valueHasMutated(),d}return a?this.remove(function(b){return m.utils.arrayIndexOf(a,b)>=0}):[]},destroy:function(a){var b=this.peek(),c="function"!=typeof a||m.isObservable(a)?function(b){return b===a}:a;this.valueWillMutate();for(var d=b.length-1;d>=0;d--){var e=b[d];c(e)&&(b[d]._destroy=!0)}this.valueHasMutated()},destroyAll:function(a){return a===b?this.destroy(function(){return!0}):a?this.destroy(function(b){return m.utils.arrayIndexOf(a,b)>=0}):[]},indexOf:function(a){var b=this();return m.utils.arrayIndexOf(b,a)},replace:function(a,b){var c=this.indexOf(a);c>=0&&(this.valueWillMutate(),this.peek()[c]=b,this.valueHasMutated())}},m.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(a){m.observableArray.fn[a]=function(){var b=this.peek();this.valueWillMutate(),this.cacheDiffForKnownOperation(b,a,arguments);var c=b[a].apply(b,arguments);return this.valueHasMutated(),c}}),m.utils.arrayForEach(["slice"],function(a){m.observableArray.fn[a]=function(){var b=this();return b[a].apply(b,arguments)}}),m.exportSymbol("observableArray",m.observableArray);var q="arrayChange";m.extenders.trackArrayChanges=function(a){function b(){if(!d){d=!0;var b=a.notifySubscribers;a.notifySubscribers=function(a,c){return c&&c!==o||++f,b.apply(this,arguments)};var g=[].concat(a.peek()||[]);e=null,a.subscribe(function(b){if(b=[].concat(b||[]),a.hasSubscriptionsForEvent(q)){var d=c(g,b);d.length&&a.notifySubscribers(d,q)}g=b,e=null,f=0})}}function c(a,b){return(!e||f>1)&&(e=m.utils.compareArrays(a,b,{sparse:!0})),e}if(!a.cacheDiffForKnownOperation){var d=!1,e=null,f=0,g=a.subscribe;a.subscribe=a.subscribe=function(a,c,d){return d===q&&b(),g.apply(this,arguments)},a.cacheDiffForKnownOperation=function(a,b,c){function g(a,b,c){h.push({status:a,value:b,index:c})}if(d&&!f){var h=[],i=a.length,j=c.length,k=0;switch(b){case"push":k=i;case"unshift":for(var l=0;j>l;l++)g("added",c[l],k+l);break;case"pop":k=i-1;case"shift":i&&g("deleted",a[k],k);break;case"splice":for(var m=Math.min(Math.max(0,c[0]<0?i+c[0]:c[0]),i),n=1===j?i:Math.min(m+(c[1]||0),i),o=m+j-2,p=Math.max(n,o),l=m,q=2;p>l;++l,++q)n>l&&g("deleted",a[l],l),o>l&&g("added",c[q],l);break;default:return}e=h}}}},m.dependentObservable=function(c,d,e){function f(a){x.push(a.subscribe(h))}function g(){m.utils.arrayForEach(x,function(a){a.dispose()}),x=[]}function h(){var a=j.throttleEvaluation;a&&a>=0?(clearTimeout(y),y=setTimeout(i,a)):i()}function i(){if(!p){if(v&&v()){if(!q)return w(),o=!0,void 0}else q=!1;p=!0;try{var c=m.utils.arrayMap(x,function(a){return a.target});m.dependencyDetection.begin(function(a){var d;(d=m.utils.arrayIndexOf(c,a))>=0?c[d]=b:f(a)});for(var e=d?r.call(d):r(),g=c.length-1;g>=0;g--)c[g]&&x.splice(g,1)[0].dispose();o=!0,j.equalityComparer&&j.equalityComparer(n,e)||(j.notifySubscribers(n,"beforeChange"),n=e,a&&(j._latestValue=n),j.notifySubscribers(n))}finally{m.dependencyDetection.end(),p=!1}x.length||w()}}function j(){if(arguments.length>0){if("function"!=typeof s)throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return s.apply(d,arguments),this}return o||i(),m.dependencyDetection.registerDependency(j),n}function k(){return o||i(),n}function l(){return!o||x.length>0}var n,o=!1,p=!1,q=!1,r=c;if(r&&"object"==typeof r?(e=r,r=e.read):(e=e||{},r||(r=e.read)),"function"!=typeof r)throw new Error("Pass a function that returns the value of the ko.computed");var s=e.write,t=e.disposeWhenNodeIsRemoved||e.disposeWhenNodeIsRemoved||null,u=e.disposeWhen||e.disposeWhen,v=u,w=g,x=[],y=null;return d||(d=e.owner),j.peek=k,j.getDependenciesCount=function(){return x.length},j.hasWriteFunction="function"==typeof e.write,j.dispose=function(){w()},j.isActive=l,m.subscribable.call(j),m.utils.extend(j,m.dependentObservable.fn),m.exportProperty(j,"peek",j.peek),m.exportProperty(j,"dispose",j.dispose),m.exportProperty(j,"isActive",j.isActive),m.exportProperty(j,"getDependenciesCount",j.getDependenciesCount),t&&(q=!0,t.nodeType&&(v=function(){return!m.utils.domNodeIsAttachedToDocument(t)||u&&u()})),e.deferEvaluation!==!0&&i(),t&&l()&&(w=function(){m.utils.domNodeDisposal.removeDisposeCallback(t,w),g()},m.utils.domNodeDisposal.addDisposeCallback(t,w)),j},m.isComputed=function(a){return m.hasPrototype(a,m.dependentObservable)};var r=m.observable.protoProperty;m.dependentObservable[r]=m.observable,m.dependentObservable.fn={equalityComparer:i},m.dependentObservable.fn[r]=m.dependentObservable,m.exportSymbol("dependentObservable",m.dependentObservable),m.exportSymbol("computed",m.dependentObservable),m.exportSymbol("isComputed",m.isComputed),function(){function a(e,f,g){g=g||new d,e=f(e);var h=!("object"!=typeof e||null===e||e===b||e instanceof Date||e instanceof String||e instanceof Number||e instanceof Boolean);if(!h)return e;var i=e instanceof Array?[]:{};return g.save(e,i),c(e,function(c){var d=f(e[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":i[c]=d;break;case"object":case"undefined":var h=g.get(d);i[c]=h!==b?h:a(d,f,g)}}),i}function c(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(var d in a)b(d)}function d(){this.keys=[],this.values=[]}var e=10;m.toJS=function(b){if(0==arguments.length)throw new Error("When calling ko.toJS, pass the object you want to convert.");return a(b,function(a){for(var b=0;m.isObservable(a)&&e>b;b++)a=a();return a})},m.toJSON=function(a,b,c){var d=m.toJS(a);return m.utils.stringifyJson(d,b,c)},d.prototype={constructor:d,save:function(a,b){var c=m.utils.arrayIndexOf(this.keys,a);c>=0?this.values[c]=b:(this.keys.push(a),this.values.push(b))},get:function(a){var c=m.utils.arrayIndexOf(this.keys,a);return c>=0?this.values[c]:b}}}(),m.exportSymbol("toJS",m.toJS),m.exportSymbol("toJSON",m.toJSON),function(){var a="__ko__hasDomDataOptionValue__";m.selectExtensions={readValue:function(c){switch(m.utils.tagNameLower(c)){case"option":return c[a]===!0?m.utils.domData.get(c,m.bindingHandlers.options.optionValueDomDataKey):m.utils.ieVersion<=7?c.getAttributeNode("value")&&c.getAttributeNode("value").specified?c.value:c.text:c.value;case"select":return c.selectedIndex>=0?m.selectExtensions.readValue(c.options[c.selectedIndex]):b;default:return c.value}},writeValue:function(c,d){switch(m.utils.tagNameLower(c)){case"option":switch(typeof d){case"string":m.utils.domData.set(c,m.bindingHandlers.options.optionValueDomDataKey,b),a in c&&delete c[a],c.value=d;break;default:m.utils.domData.set(c,m.bindingHandlers.options.optionValueDomDataKey,d),c[a]=!0,c.value="number"==typeof d?d:""}break;case"select":""===d&&(d=b),(null===d||d===b)&&(c.selectedIndex=-1);for(var e=c.options.length-1;e>=0;e--)if(m.selectExtensions.readValue(c.options[e])==d){c.selectedIndex=e;break}c.size>1||-1!==c.selectedIndex||(c.selectedIndex=0);break;default:(null===d||d===b)&&(d=""),c.value=d}}}}(),m.exportSymbol("selectExtensions",m.selectExtensions),m.exportSymbol("selectExtensions.readValue",m.selectExtensions.readValue),m.exportSymbol("selectExtensions.writeValue",m.selectExtensions.writeValue),m.expressionRewriting=function(){function a(a){if(m.utils.arrayIndexOf(d,a)>=0)return!1;var b=a.match(e);return null===b?!1:b[1]?"Object("+b[1]+")"+b[2]:a}function b(a){var b=m.utils.stringTrim(a);123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c,d,e=[],f=b.match(l),g=0;if(f){f.push(",");for(var h,i=0;h=f[i];++i){var j=h.charCodeAt(0);if(44===j){if(0>=g){c&&e.push(d?{key:c,value:d.join("")}:{unknown:c}),c=d=g=0;continue}}else if(58===j){if(!d)continue}else if(47===j&&i&&h.length>1){var k=f[i-1].match(n);k&&!o[k[0]]&&(b=b.substr(b.indexOf(h)+1),f=b.match(l),f.push(","),i=-1,h="/")}else if(40===j||123===j||91===j)++g;else if(41===j||125===j||93===j)--g;else if(!c&&!d){c=34===j||39===j?h.slice(1,-1):h;continue}d?d.push(h):d=[h]}}return e}function c(c,d){function e(b,c){function d(a){return a&&a.preprocess?c=a.preprocess(c,b,e):!0}var i;d(m.getBindingHandler(b))&&(p[b]&&(i=a(c))&&g.push("'"+b+"':function(_z){"+i+"=_z}"),h&&(c="function(){return "+c+" }"),f.push("'"+b+"':"+c))}d=d||{};var f=[],g=[],h=d.valueAccessors,i="string"==typeof c?b(c):c;return m.utils.arrayForEach(i,function(a){e(a.key||a.unknown,a.value)}),g.length&&e("_ko_property_writers","{"+g.join(",")+"}"),f.join(",")}var d=["true","false","null","undefined"],e=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,f='"(?:[^"\\\\]|\\\\.)*"',g="'(?:[^'\\\\]|\\\\.)*'",h="/(?:[^/\\\\]|\\\\.)*/w*",i=",\"'{}()/:[\\]",j="[^\\s:,/][^"+i+"]*[^\\s"+i+"]",k="[^\\s]",l=RegExp(f+"|"+g+"|"+h+"|"+j+"|"+k,"g"),n=/[\])"'A-Za-z0-9_$]+$/,o={"in":1,"return":1,"typeof":1},p={};return{bindingRewriteValidators:[],twoWayBindings:p,parseObjectLiteral:b,preProcessBindings:c,keyValueArrayContainsKey:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},writeValueToProperty:function(a,b,c,d,e){if(a&&m.isObservable(a))!m.isWriteableObservable(a)||e&&a.peek()===d||a(d);else{var f=b.get("_ko_property_writers");f&&f[c]&&f[c](d)}}}}(),m.exportSymbol("expressionRewriting",m.expressionRewriting),m.exportSymbol("expressionRewriting.bindingRewriteValidators",m.expressionRewriting.bindingRewriteValidators),m.exportSymbol("expressionRewriting.parseObjectLiteral",m.expressionRewriting.parseObjectLiteral),m.exportSymbol("expressionRewriting.preProcessBindings",m.expressionRewriting.preProcessBindings),m.exportSymbol("expressionRewriting._twoWayBindings",m.expressionRewriting.twoWayBindings),m.exportSymbol("jsonExpressionRewriting",m.expressionRewriting),m.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",m.expressionRewriting.preProcessBindings),function(){function a(a){return 8==a.nodeType&&h.test(g?a.text:a.nodeValue)}function b(a){return 8==a.nodeType&&i.test(g?a.text:a.nodeValue)}function c(c,d){for(var e=c,f=1,g=[];e=e.nextSibling;){if(b(e)&&(f--,0===f))return g;g.push(e),a(e)&&f++}if(!d)throw new Error("Cannot find closing comment tag to match: "+c.nodeValue);return null}function e(a,b){var d=c(a,b);return d?d.length>0?d[d.length-1].nextSibling:a.nextSibling:null}function f(c){var d=c.firstChild,f=null;if(d)do if(f)f.push(d);else if(a(d)){var g=e(d,!0);g?d=g:f=[d]}else b(d)&&(f=[d]);while(d=d.nextSibling);return f}var g=d&&"<!--test-->"===d.createComment("test").text,h=g?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,i=g?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,j={ul:!0,ol:!0};m.virtualElements={allowedBindings:{},childNodes:function(b){return a(b)?c(b):b.childNodes},emptyNode:function(b){if(a(b))for(var c=m.virtualElements.childNodes(b),d=0,e=c.length;e>d;d++)m.removeNode(c[d]);else m.utils.emptyDomNode(b)},setDomNodeChildren:function(b,c){if(a(b)){m.virtualElements.emptyNode(b);for(var d=b.nextSibling,e=0,f=c.length;f>e;e++)d.parentNode.insertBefore(c[e],d)}else m.utils.setDomNodeChildren(b,c)},prepend:function(b,c){a(b)?b.parentNode.insertBefore(c,b.nextSibling):b.firstChild?b.insertBefore(c,b.firstChild):b.appendChild(c)},insertAfter:function(b,c,d){d?a(b)?b.parentNode.insertBefore(c,d.nextSibling):d.nextSibling?b.insertBefore(c,d.nextSibling):b.appendChild(c):m.virtualElements.prepend(b,c)},firstChild:function(c){return a(c)?!c.nextSibling||b(c.nextSibling)?null:c.nextSibling:c.firstChild},nextSibling:function(c){return a(c)&&(c=e(c)),c.nextSibling&&b(c.nextSibling)?null:c.nextSibling},hasBindingValue:a,virtualNodeBindingValue:function(a){var b=(g?a.text:a.nodeValue).match(h);return b?b[1]:null},normaliseVirtualElementDomStructure:function(a){if(j[m.utils.tagNameLower(a)]){var b=a.firstChild;if(b)do if(1===b.nodeType){var c=f(b);if(c)for(var d=b.nextSibling,e=0;e<c.length;e++)d?a.insertBefore(c[e],d):a.appendChild(c[e])}while(b=b.nextSibling)}}}}(),m.exportSymbol("virtualElements",m.virtualElements),m.exportSymbol("virtualElements.allowedBindings",m.virtualElements.allowedBindings),m.exportSymbol("virtualElements.emptyNode",m.virtualElements.emptyNode),m.exportSymbol("virtualElements.insertAfter",m.virtualElements.insertAfter),m.exportSymbol("virtualElements.prepend",m.virtualElements.prepend),m.exportSymbol("virtualElements.setDomNodeChildren",m.virtualElements.setDomNodeChildren),function(){function a(a,c,d){var e=a+(d&&d.valueAccessors||"");
return c[e]||(c[e]=b(a,d))}function b(a,b){var c=m.expressionRewriting.preProcessBindings(a,b),d="with($context){with($data||{}){return{"+c+"}}}";return new Function("$context","$element",d)}var c="data-bind";m.bindingProvider=function(){this.bindingCache={}},m.utils.extend(m.bindingProvider.prototype,{nodeHasBindings:function(a){switch(a.nodeType){case 1:return null!=a.getAttribute(c);case 8:return m.virtualElements.hasBindingValue(a);default:return!1}},getBindings:function(a,b){var c=this.getBindingsString(a,b);return c?this.parseBindingsString(c,b,a):null},getBindingAccessors:function(a,b){var c=this.getBindingsString(a,b);return c?this.parseBindingsString(c,b,a,{valueAccessors:!0}):null},getBindingsString:function(a){switch(a.nodeType){case 1:return a.getAttribute(c);case 8:return m.virtualElements.virtualNodeBindingValue(a);default:return null}},parseBindingsString:function(b,c,d,e){try{var f=a(b,this.bindingCache,e);return f(c,d)}catch(g){throw g.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+g.message,g}}}),m.bindingProvider.instance=new m.bindingProvider}(),m.exportSymbol("bindingProvider",m.bindingProvider),function(){function a(a){return function(){return a}}function d(a){return a()}function e(a){return m.utils.objectMap(m.dependencyDetection.ignore(a),function(b,c){return function(){return a()[c]}})}function f(b,c,d){return"function"==typeof b?e(b.bind(null,c,d)):m.utils.objectMap(b,a)}function g(a,b){return e(this.getBindings.bind(this,a,b))}function h(a){var b=m.virtualElements.allowedBindings[a];if(!b)throw new Error("The binding '"+a+"' cannot be used with virtual elements")}function i(a,b,c){var d,e=m.virtualElements.firstChild(b),f=m.bindingProvider.instance,g=f.preprocessNode;if(g){for(;d=e;)e=m.virtualElements.nextSibling(d),g.call(f,d);e=m.virtualElements.firstChild(b)}for(;d=e;)e=m.virtualElements.nextSibling(d),j(a,d,c)}function j(a,b,c){var d=!0,e=1===b.nodeType;e&&m.virtualElements.normaliseVirtualElementDomStructure(b);var f=e&&c||m.bindingProvider.instance.nodeHasBindings(b);f&&(d=l(b,null,a,c).shouldBindDescendants),d&&!o[m.utils.tagNameLower(b)]&&i(a,b,!e)}function k(a){var b=[],c={},d=[];return m.utils.objectForEach(a,function e(f){if(!c[f]){var g=m.getBindingHandler(f);g&&(g.after&&(d.push(f),m.utils.arrayForEach(g.after,function(b){if(a[b]){if(-1!==m.utils.arrayIndexOf(d,b))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+d.join(", "));e(b)}}),d.pop()),b.push({key:f,handler:g})),c[f]=!0}}),b}function l(a,c,e,f){function i(){return m.utils.objectMap(q?q():l,d)}var j=m.utils.domData.get(a,p);if(!c){if(j)throw Error("You cannot apply bindings multiple times to the same element.");m.utils.domData.set(a,p,!0)}!j&&f&&m.storedBindingContextForNode(a,e);var l;if(c&&"function"!=typeof c)l=c;else{var n=m.bindingProvider.instance,o=n.getBindingAccessors||g;if(c||e._subscribable){var q=m.dependentObservable(function(){return l=c?c(e,a):o.call(n,a,e),l&&e._subscribable&&e._subscribable(),l},null,{disposeWhenNodeIsRemoved:a});l&&q.isActive()||(q=null)}else l=m.dependencyDetection.ignore(o,n,[a,e])}var r;if(l){var s=q?function(a){return function(){return d(q()[a])}}:function(a){return l[a]};i.get=function(a){return l[a]&&d(s(a))},i.has=function(a){return a in l};var t=k(l);m.utils.arrayForEach(t,function(c){var d=c.handler.init,f=c.handler.update,g=c.key;8===a.nodeType&&h(g);try{"function"==typeof d&&m.dependencyDetection.ignore(function(){var c=d(a,s(g),i,e.$data,e);if(c&&c.controlsDescendantBindings){if(r!==b)throw new Error("Multiple bindings ("+r+" and "+g+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");r=g}}),"function"==typeof f&&m.dependentObservable(function(){f(a,s(g),i,e.$data,e)},null,{disposeWhenNodeIsRemoved:a})}catch(j){throw j.message='Unable to process binding "'+g+": "+l[g]+'"\nMessage: '+j.message,j}})}return{shouldBindDescendants:r===b}}function n(a){return a&&a instanceof m.bindingContext?a:new m.bindingContext(a)}m.bindingHandlers={};var o={script:!0};m.getBindingHandler=function(a){return m.bindingHandlers[a]},m.bindingContext=function(a,c,d,e){function f(){var b=j?a():a;return c?(c._subscribable&&c._subscribable(),m.utils.extend(i,c),k&&(i._subscribable=k)):(i.$parents=[],i.$root=b,i.ko=m),i.$rawData=a,i.$data=b,d&&(i[d]=b),e&&e(i,c,b),i.$data}function g(){return h&&!m.utils.anyDomNodeIsAttachedToDocument(h)}var h,i=this,j="function"==typeof a,k=m.dependentObservable(f,null,{disposeWhen:g,disposeWhenNodeIsRemoved:!0});k.isActive()&&(i._subscribable=k,k.equalityComparer=null,h=[],k._addNode=function(a){h.push(a),m.utils.domNodeDisposal.addDisposeCallback(a,function(a){m.utils.arrayRemoveItem(h,a),h.length||(k.dispose(),i._subscribable=k=b)})})},m.bindingContext.prototype.createChildContext=function(a,b,c){return new m.bindingContext(a,this,b,function(a,b){a.$parentContext=b,a.$parent=b.$data,a.$parents=(b.$parents||[]).slice(0),a.$parents.unshift(a.$parent),c&&c(a)})},m.bindingContext.prototype.extend=function(a){return new m.bindingContext(this.$rawData,this,null,function(b){m.utils.extend(b,"function"==typeof a?a():a)})};var p=m.utils.domData.nextKey(),q=m.utils.domData.nextKey();m.storedBindingContextForNode=function(a,b){return 2!=arguments.length?m.utils.domData.get(a,q):(m.utils.domData.set(a,q,b),b._subscribable&&b._subscribable._addNode(a),void 0)},m.applyBindingAccessorsToNode=function(a,b,c){return 1===a.nodeType&&m.virtualElements.normaliseVirtualElementDomStructure(a),l(a,b,n(c),!0)},m.applyBindingsToNode=function(a,b,c){var d=n(c);return m.applyBindingAccessorsToNode(a,f(b,d,a),d)},m.applyBindingsToDescendants=function(a,b){(1===b.nodeType||8===b.nodeType)&&i(n(a),b,!0)},m.applyBindings=function(a,b){if(b&&1!==b.nodeType&&8!==b.nodeType)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||c.document.body,j(n(a),b,!0)},m.contextFor=function(a){switch(a.nodeType){case 1:case 8:var c=m.storedBindingContextForNode(a);if(c)return c;if(a.parentNode)return m.contextFor(a.parentNode)}return b},m.dataFor=function(a){var c=m.contextFor(a);return c?c.$data:b},m.exportSymbol("bindingHandlers",m.bindingHandlers),m.exportSymbol("applyBindings",m.applyBindings),m.exportSymbol("applyBindingsToDescendants",m.applyBindingsToDescendants),m.exportSymbol("applyBindingAccessorsToNode",m.applyBindingAccessorsToNode),m.exportSymbol("applyBindingsToNode",m.applyBindingsToNode),m.exportSymbol("contextFor",m.contextFor),m.exportSymbol("dataFor",m.dataFor)}();var s={"class":"className","for":"htmlFor"};m.bindingHandlers.attr={update:function(a,c){var d=m.utils.unwrapObservable(c())||{};m.utils.objectForEach(d,function(c,d){d=m.utils.unwrapObservable(d);var e=d===!1||null===d||d===b;e&&a.removeAttribute(c),m.utils.ieVersion<=8&&c in s?(c=s[c],e?a.removeAttribute(c):a[c]=d):e||a.setAttribute(c,d.toString()),"name"===c&&m.utils.setElementName(a,e?"":d.toString())})}},function(){m.bindingHandlers.checked={after:["value","attr"],init:function(a,c,d){function e(){return d.has("checkedValue")?m.utils.unwrapObservable(d.get("checkedValue")):a.value}function f(){var b=a.checked,f=l?e():b;if(n&&(!i||b)){var g=m.dependencyDetection.ignore(c);j?k!==f?(b&&(m.utils.addOrRemoveItem(g,f,!0),m.utils.addOrRemoveItem(g,k,!1)),k=f):m.utils.addOrRemoveItem(g,f,b):m.expressionRewriting.writeValueToProperty(g,d,"checked",f,!0)}}function g(){var b=m.utils.unwrapObservable(c());a.checked=j?m.utils.arrayIndexOf(b,e())>=0:h?b:e()===b}var h="checkbox"==a.type,i="radio"==a.type;if(h||i){var j=h&&m.utils.unwrapObservable(c())instanceof Array,k=j?e():b,l=i||j,n=!1;i&&!a.name&&m.bindingHandlers.uniqueName.init(a,function(){return!0}),m.dependentObservable(f,null,{disposeWhenNodeIsRemoved:a}),m.utils.registerEventHandler(a,"click",f),m.dependentObservable(g,null,{disposeWhenNodeIsRemoved:a}),n=!0}}},m.expressionRewriting.twoWayBindings.checked=!0,m.bindingHandlers.checkedValue={update:function(a,b){a.value=m.utils.unwrapObservable(b())}}}();var t="__ko__cssValue";m.bindingHandlers.css={update:function(a,b){var c=m.utils.unwrapObservable(b());"object"==typeof c?m.utils.objectForEach(c,function(b,c){c=m.utils.unwrapObservable(c),m.utils.toggleDomNodeCssClass(a,b,c)}):(c=String(c||""),m.utils.toggleDomNodeCssClass(a,a[t],!1),a[t]=c,m.utils.toggleDomNodeCssClass(a,c,!0))}},m.bindingHandlers.enable={update:function(a,b){var c=m.utils.unwrapObservable(b());c&&a.disabled?a.removeAttribute("disabled"):c||a.disabled||(a.disabled=!0)}},m.bindingHandlers.disable={update:function(a,b){m.bindingHandlers.enable.update(a,function(){return!m.utils.unwrapObservable(b())})}},m.bindingHandlers.event={init:function(a,b,c,d,e){var f=b()||{};m.utils.objectForEach(f,function(f){"string"==typeof f&&m.utils.registerEventHandler(a,f,function(a){var g,h=b()[f];if(h){try{var i=m.utils.makeArray(arguments);d=e.$data,i.unshift(d),g=h.apply(d,i)}finally{g!==!0&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}var j=c.get(f+"Bubble")!==!1;j||(a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation())}})})}},m.bindingHandlers.foreach={makeTemplateValueAccessor:function(a){return function(){var b=a(),c=m.utils.peekObservable(b);return c&&"number"!=typeof c.length?(m.utils.unwrapObservable(b),{foreach:c.data,as:c.as,includeDestroyed:c.includeDestroyed,afterAdd:c.afterAdd,beforeRemove:c.beforeRemove,afterRender:c.afterRender,beforeMove:c.beforeMove,afterMove:c.afterMove,templateEngine:m.nativeTemplateEngine.instance}):{foreach:b,templateEngine:m.nativeTemplateEngine.instance}}},init:function(a,b){return m.bindingHandlers.template.init(a,m.bindingHandlers.foreach.makeTemplateValueAccessor(b))},update:function(a,b,c,d,e){return m.bindingHandlers.template.update(a,m.bindingHandlers.foreach.makeTemplateValueAccessor(b),c,d,e)}},m.expressionRewriting.bindingRewriteValidators.foreach=!1,m.virtualElements.allowedBindings.foreach=!0;var u="__ko_hasfocusUpdating",v="__ko_hasfocusLastValue";m.bindingHandlers.hasfocus={init:function(a,b,c){var d=function(d){a[u]=!0;var e=a.ownerDocument;if("activeElement"in e){var f;try{f=e.activeElement}catch(g){f=e.body}d=f===a}var h=b();m.expressionRewriting.writeValueToProperty(h,c,"hasfocus",d,!0),a[v]=d,a[u]=!1},e=d.bind(null,!0),f=d.bind(null,!1);m.utils.registerEventHandler(a,"focus",e),m.utils.registerEventHandler(a,"focusin",e),m.utils.registerEventHandler(a,"blur",f),m.utils.registerEventHandler(a,"focusout",f)},update:function(a,b){var c=!!m.utils.unwrapObservable(b());a[u]||a[v]===c||(c?a.focus():a.blur(),m.dependencyDetection.ignore(m.utils.triggerEvent,null,[a,c?"focusin":"focusout"]))}},m.expressionRewriting.twoWayBindings.hasfocus=!0,m.bindingHandlers.hasFocus=m.bindingHandlers.hasfocus,m.expressionRewriting.twoWayBindings.hasFocus=!0,m.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){m.utils.setHtml(a,b())}};var w=m.utils.domData.nextKey();l("if"),l("ifnot",!1,!0),l("with",!0,!1,function(a,b){return a.createChildContext(b)}),m.bindingHandlers.options={init:function(a){if("select"!==m.utils.tagNameLower(a))throw new Error("options binding applies only to SELECT elements");for(;a.length>0;)a.remove(0);return{controlsDescendantBindings:!0}},update:function(a,c,e){function f(){return m.utils.arrayFilter(a.options,function(a){return a.selected})}function g(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function h(a,c,f){f.length&&(k=f[0].selected?[m.selectExtensions.readValue(f[0])]:[],s=!0);var h=d.createElement("option");if(a===q)m.utils.setTextContent(h,e.get("optionsCaption")),m.selectExtensions.writeValue(h,b);else{var i=g(a,e.get("optionsValue"),a);m.selectExtensions.writeValue(h,m.utils.unwrapObservable(i));var j=g(a,e.get("optionsText"),i);m.utils.setTextContent(h,j)}return[h]}function i(b,c){if(k.length){var d=m.utils.arrayIndexOf(k,m.selectExtensions.readValue(c[0]))>=0;m.utils.setOptionNodeSelectionState(c[0],d),s&&!d&&m.dependencyDetection.ignore(m.utils.triggerEvent,null,[a,"change"])}}var j,k,l=0==a.length,n=!l&&a.multiple?a.scrollTop:null,o=m.utils.unwrapObservable(c()),p=e.get("optionsIncludeDestroyed"),q={};if(k=a.multiple?m.utils.arrayMap(f(),m.selectExtensions.readValue):a.selectedIndex>=0?[m.selectExtensions.readValue(a.options[a.selectedIndex])]:[],o){"undefined"==typeof o.length&&(o=[o]);var r=m.utils.arrayFilter(o,function(a){return p||a===b||null===a||!m.utils.unwrapObservable(a._destroy)});e.has("optionsCaption")&&(j=m.utils.unwrapObservable(e.get("optionsCaption")),null!==j&&j!==b&&r.unshift(q))}else o=[];var s=!1,t=i;e.has("optionsAfterRender")&&(t=function(a,c){i(a,c),m.dependencyDetection.ignore(e.get("optionsAfterRender"),null,[c[0],a!==q?a:b])}),m.utils.setDomNodeChildrenFromArrayMapping(a,r,h,null,t);var u;u=a.multiple?k.length&&f().length<k.length:k.length&&a.selectedIndex>=0?m.selectExtensions.readValue(a.options[a.selectedIndex])!==k[0]:k.length||a.selectedIndex>=0,u&&m.dependencyDetection.ignore(m.utils.triggerEvent,null,[a,"change"]),m.utils.ensureSelectElementIsRenderedCorrectly(a),n&&Math.abs(n-a.scrollTop)>20&&(a.scrollTop=n)}},m.bindingHandlers.options.optionValueDomDataKey=m.utils.domData.nextKey(),m.bindingHandlers.selectedOptions={after:["options","foreach"],init:function(a,b,c){m.utils.registerEventHandler(a,"change",function(){var d=b(),e=[];m.utils.arrayForEach(a.getElementsByTagName("option"),function(a){a.selected&&e.push(m.selectExtensions.readValue(a))}),m.expressionRewriting.writeValueToProperty(d,c,"selectedOptions",e)})},update:function(a,b){if("select"!=m.utils.tagNameLower(a))throw new Error("values binding applies only to SELECT elements");var c=m.utils.unwrapObservable(b());c&&"number"==typeof c.length&&m.utils.arrayForEach(a.getElementsByTagName("option"),function(a){var b=m.utils.arrayIndexOf(c,m.selectExtensions.readValue(a))>=0;m.utils.setOptionNodeSelectionState(a,b)})}},m.expressionRewriting.twoWayBindings.selectedOptions=!0,m.bindingHandlers.style={update:function(a,b){var c=m.utils.unwrapObservable(b()||{});m.utils.objectForEach(c,function(b,c){c=m.utils.unwrapObservable(c),a.style[b]=c||""})}},m.bindingHandlers.submit={init:function(a,b,c,d,e){if("function"!=typeof b())throw new Error("The value for a submit binding must be a function");m.utils.registerEventHandler(a,"submit",function(c){var d,f=b();try{d=f.call(e.$data,a)}finally{d!==!0&&(c.preventDefault?c.preventDefault():c.returnValue=!1)}})}},m.bindingHandlers.text={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){m.utils.setTextContent(a,b())}},m.virtualElements.allowedBindings.text=!0,m.bindingHandlers.uniqueName={init:function(a,b){if(b()){var c="ko_unique_"+ ++m.bindingHandlers.uniqueName.currentIndex;m.utils.setElementName(a,c)}}},m.bindingHandlers.uniqueName.currentIndex=0,m.bindingHandlers.value={after:["options","foreach"],init:function(a,b,c){var d=["change"],e=c.get("valueUpdate"),f=!1;e&&("string"==typeof e&&(e=[e]),m.utils.arrayPushAll(d,e),d=m.utils.arrayGetDistinctValues(d));var g=function(){f=!1;var d=b(),e=m.selectExtensions.readValue(a);m.expressionRewriting.writeValueToProperty(d,c,"value",e)},h=m.utils.ieVersion&&"input"==a.tagName.toLowerCase()&&"text"==a.type&&"off"!=a.autocomplete&&(!a.form||"off"!=a.form.autocomplete);h&&-1==m.utils.arrayIndexOf(d,"propertychange")&&(m.utils.registerEventHandler(a,"propertychange",function(){f=!0}),m.utils.registerEventHandler(a,"blur",function(){f&&g()})),m.utils.arrayForEach(d,function(b){var c=g;m.utils.stringStartsWith(b,"after")&&(c=function(){setTimeout(g,0)},b=b.substring("after".length)),m.utils.registerEventHandler(a,b,c)})},update:function(a,b){var c="select"===m.utils.tagNameLower(a),d=m.utils.unwrapObservable(b()),e=m.selectExtensions.readValue(a),f=d!==e;if(f){var g=function(){m.selectExtensions.writeValue(a,d)};g(),c&&(d!==m.selectExtensions.readValue(a)?m.dependencyDetection.ignore(m.utils.triggerEvent,null,[a,"change"]):setTimeout(g,0))}}},m.expressionRewriting.twoWayBindings.value=!0,m.bindingHandlers.visible={update:function(a,b){var c=m.utils.unwrapObservable(b()),d=!("none"==a.style.display);c&&!d?a.style.display="":!c&&d&&(a.style.display="none")}},k("click"),m.templateEngine=function(){},m.templateEngine.prototype.renderTemplateSource=function(){throw new Error("Override renderTemplateSource")},m.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(){throw new Error("Override createJavaScriptEvaluatorBlock")},m.templateEngine.prototype.makeTemplateSource=function(a,b){if("string"==typeof a){b=b||d;var c=b.getElementById(a);if(!c)throw new Error("Cannot find template with ID "+a);return new m.templateSources.domElement(c)}if(1==a.nodeType||8==a.nodeType)return new m.templateSources.anonymousTemplate(a);throw new Error("Unknown template type: "+a)},m.templateEngine.prototype.renderTemplate=function(a,b,c,d){var e=this.makeTemplateSource(a,d);return this.renderTemplateSource(e,b,c)},m.templateEngine.prototype.isTemplateRewritten=function(a,b){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(a,b).data("isRewritten")},m.templateEngine.prototype.rewriteTemplate=function(a,b,c){var d=this.makeTemplateSource(a,c),e=b(d.text());d.text(e),d.data("isRewritten",!0)},m.exportSymbol("templateEngine",m.templateEngine),m.templateRewriting=function(){function a(a){for(var b=m.expressionRewriting.bindingRewriteValidators,c=0;c<a.length;c++){var d=a[c].key;if(b.hasOwnProperty(d)){var e=b[d];if("function"==typeof e){var f=e(a[c].value);if(f)throw new Error(f)}else if(!e)throw new Error("This template engine does not support the '"+d+"' binding within its templates")}}}function b(b,c,d,e){var f=m.expressionRewriting.parseObjectLiteral(b);a(f);var g=m.expressionRewriting.preProcessBindings(f,{valueAccessors:!0}),h="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+g+" } })()},'"+d.toLowerCase()+"')";return e.createJavaScriptEvaluatorBlock(h)+c}var c=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,d=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(a,b,c){b.isTemplateRewritten(a,c)||b.rewriteTemplate(a,function(a){return m.templateRewriting.memoizeBindingAttributeSyntax(a,b)},c)},memoizeBindingAttributeSyntax:function(a,e){return a.replace(c,function(){return b(arguments[4],arguments[1],arguments[2],e)}).replace(d,function(){return b(arguments[1],"<!-- ko -->","#comment",e)})},applyMemoizedBindingsToNextSibling:function(a,b){return m.memoization.memoize(function(c,d){var e=c.nextSibling;e&&e.nodeName.toLowerCase()===b&&m.applyBindingAccessorsToNode(e,a,d)})}}}(),m.exportSymbol("__tr_ambtns",m.templateRewriting.applyMemoizedBindingsToNextSibling),function(){m.templateSources={},m.templateSources.domElement=function(a){this.domElement=a},m.templateSources.domElement.prototype.text=function(){var a=m.utils.tagNameLower(this.domElement),b="script"===a?"text":"textarea"===a?"value":"innerHTML";if(0==arguments.length)return this.domElement[b];var c=arguments[0];"innerHTML"===b?m.utils.setHtml(this.domElement,c):this.domElement[b]=c};var a=m.utils.domData.nextKey()+"_";m.templateSources.domElement.prototype.data=function(b){return 1===arguments.length?m.utils.domData.get(this.domElement,a+b):(m.utils.domData.set(this.domElement,a+b,arguments[1]),void 0)};var c=m.utils.domData.nextKey();m.templateSources.anonymousTemplate=function(a){this.domElement=a},m.templateSources.anonymousTemplate.prototype=new m.templateSources.domElement,m.templateSources.anonymousTemplate.prototype.constructor=m.templateSources.anonymousTemplate,m.templateSources.anonymousTemplate.prototype.text=function(){if(0==arguments.length){var a=m.utils.domData.get(this.domElement,c)||{};return a.textData===b&&a.containerData&&(a.textData=a.containerData.innerHTML),a.textData}var d=arguments[0];m.utils.domData.set(this.domElement,c,{textData:d})},m.templateSources.domElement.prototype.nodes=function(){if(0==arguments.length){var a=m.utils.domData.get(this.domElement,c)||{};return a.containerData}var b=arguments[0];m.utils.domData.set(this.domElement,c,{containerData:b})},m.exportSymbol("templateSources",m.templateSources),m.exportSymbol("templateSources.domElement",m.templateSources.domElement),m.exportSymbol("templateSources.anonymousTemplate",m.templateSources.anonymousTemplate)}(),function(){function a(a,b,c){for(var d,e=a,f=m.virtualElements.nextSibling(b);e&&(d=e)!==f;)e=m.virtualElements.nextSibling(d),c(d,e)}function c(b,c){if(b.length){var d=b[0],e=b[b.length-1],f=d.parentNode,g=m.bindingProvider.instance,h=g.preprocessNode;if(h){if(a(d,e,function(a,b){var c=a.previousSibling,f=h.call(g,a);f&&(a===d&&(d=f[0]||b),a===e&&(e=f[f.length-1]||c))}),b.length=0,!d)return;d===e?b.push(d):(b.push(d,e),m.utils.fixUpContinuousNodeArray(b,f))}a(d,e,function(a){(1===a.nodeType||8===a.nodeType)&&m.applyBindings(c,a)}),a(d,e,function(a){(1===a.nodeType||8===a.nodeType)&&m.memoization.unmemoizeDomNodeAndDescendants(a,[c])}),m.utils.fixUpContinuousNodeArray(b,f)}}function d(a){return a.nodeType?a:a.length>0?a[0]:null}function e(a,b,e,f,h){h=h||{};var i=a&&d(a),j=i&&i.ownerDocument,k=h.templateEngine||g;m.templateRewriting.ensureTemplateIsRewritten(e,k,j);var l=k.renderTemplate(e,f,h,j);if("number"!=typeof l.length||l.length>0&&"number"!=typeof l[0].nodeType)throw new Error("Template engine must return an array of DOM nodes");var n=!1;switch(b){case"replaceChildren":m.virtualElements.setDomNodeChildren(a,l),n=!0;break;case"replaceNode":m.utils.replaceDomNodes(a,l),n=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+b)}return n&&(c(l,f),h.afterRender&&m.dependencyDetection.ignore(h.afterRender,null,[l,f.$data])),l}function f(a,c){var d=m.utils.domData.get(a,h);d&&"function"==typeof d.dispose&&d.dispose(),m.utils.domData.set(a,h,c&&c.isActive()?c:b)}var g;m.setTemplateEngine=function(a){if(a!=b&&!(a instanceof m.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");g=a},m.renderTemplate=function(a,c,f,h,i){if(f=f||{},(f.templateEngine||g)==b)throw new Error("Set a template engine before calling renderTemplate");if(i=i||"replaceChildren",h){var j=d(h),k=function(){return!j||!m.utils.domNodeIsAttachedToDocument(j)},l=j&&"replaceNode"==i?j.parentNode:j;return m.dependentObservable(function(){var b=c&&c instanceof m.bindingContext?c:new m.bindingContext(m.utils.unwrapObservable(c)),g="function"==typeof a?a(b.$data,b):a,k=e(h,i,g,b,f);"replaceNode"==i&&(h=k,j=d(h))},null,{disposeWhen:k,disposeWhenNodeIsRemoved:l})}return m.memoization.memoize(function(b){m.renderTemplate(a,c,f,b,"replaceNode")})},m.renderTemplateForEach=function(a,d,f,g,h){var i,j=function(b,c){i=h.createChildContext(b,f.as,function(a){a.$index=c});var d="function"==typeof a?a(b,i):a;return e(null,"ignoreTargetNode",d,i,f)},k=function(a,b){c(b,i),f.afterRender&&f.afterRender(b,a)};return m.dependentObservable(function(){var a=m.utils.unwrapObservable(d)||[];"undefined"==typeof a.length&&(a=[a]);var c=m.utils.arrayFilter(a,function(a){return f.includeDestroyed||a===b||null===a||!m.utils.unwrapObservable(a._destroy)});m.dependencyDetection.ignore(m.utils.setDomNodeChildrenFromArrayMapping,null,[g,c,j,f,k])},null,{disposeWhenNodeIsRemoved:g})};var h=m.utils.domData.nextKey();m.bindingHandlers.template={init:function(a,b){var c=m.utils.unwrapObservable(b());if("string"==typeof c||c.name)m.virtualElements.emptyNode(a);else{var d=m.virtualElements.childNodes(a),e=m.utils.moveCleanedNodesToContainerElement(d);new m.templateSources.anonymousTemplate(a).nodes(e)}return{controlsDescendantBindings:!0}},update:function(a,b,c,d,e){var g,h=m.utils.unwrapObservable(b()),i={},j=!0,k=null;if("string"!=typeof h&&(i=h,h=m.utils.unwrapObservable(i.name),"if"in i&&(j=m.utils.unwrapObservable(i["if"])),j&&"ifnot"in i&&(j=!m.utils.unwrapObservable(i.ifnot)),g=m.utils.unwrapObservable(i.data)),"foreach"in i){var l=j&&i.foreach||[];k=m.renderTemplateForEach(h||a,l,i,a,e)}else if(j){var n="data"in i?e.createChildContext(g,i.as):e;k=m.renderTemplate(h||a,n,i,a)}else m.virtualElements.emptyNode(a);f(a,k)}},m.expressionRewriting.bindingRewriteValidators.template=function(a){var b=m.expressionRewriting.parseObjectLiteral(a);return 1==b.length&&b[0].unknown?null:m.expressionRewriting.keyValueArrayContainsKey(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"},m.virtualElements.allowedBindings.template=!0}(),m.exportSymbol("setTemplateEngine",m.setTemplateEngine),m.exportSymbol("renderTemplate",m.renderTemplate),m.utils.compareArrays=function(){function a(a,e,f){return f="boolean"==typeof f?{dontLimitMoves:f}:f||{},a=a||[],e=e||[],a.length<=e.length?b(a,e,c,d,f):b(e,a,d,c,f)}function b(a,b,c,d,e){var f,g,h,i,j,k,l=Math.min,m=Math.max,n=[],o=a.length,p=b.length,q=p-o||1,r=o+p+1;for(f=0;o>=f;f++)for(i=h,n.push(h=[]),j=l(p,f+q),k=m(0,f-1),g=k;j>=g;g++)if(g)if(f)if(a[f-1]===b[g-1])h[g]=i[g-1];else{var s=i[g]||r,t=h[g-1]||r;h[g]=l(s,t)+1}else h[g]=g+1;else h[g]=f+1;var u,v=[],w=[],x=[];for(f=o,g=p;f||g;)u=n[f][g]-1,g&&u===n[f][g-1]?w.push(v[v.length]={status:c,value:b[--g],index:g}):f&&u===n[f-1][g]?x.push(v[v.length]={status:d,value:a[--f],index:f}):(--g,--f,e.sparse||v.push({status:"retained",value:b[g]}));if(w.length&&x.length){var y,z,A,B,C,D=10*o;for(y=z=0;(e.dontLimitMoves||D>y)&&(B=w[z]);z++){for(A=0;C=x[A];A++)if(B.value===C.value){B.moved=C.index,C.moved=B.index,x.splice(A,1),y=A=0;break}y+=A}}return v.reverse()}var c="added",d="deleted";return a}(),m.exportSymbol("utils.compareArrays",m.utils.compareArrays),function(){function a(a,c,d,e,f){var g=[],h=m.dependentObservable(function(){var b=c(d,f,m.utils.fixUpContinuousNodeArray(g,a))||[];g.length>0&&(m.utils.replaceDomNodes(g,b),e&&m.dependencyDetection.ignore(e,null,[d,b,f])),g.splice(0,g.length),m.utils.arrayPushAll(g,b)},null,{disposeWhenNodeIsRemoved:a,disposeWhen:function(){return!m.utils.anyDomNodeIsAttachedToDocument(g)}});return{mappedNodes:g,dependentObservable:h.isActive()?h:b}}var c=m.utils.domData.nextKey();m.utils.setDomNodeChildrenFromArrayMapping=function(d,e,f,g,h){function i(a,b){k=p[b],u!==b&&(y[a]=k),k.indexObservable(u++),m.utils.fixUpContinuousNodeArray(k.mappedNodes,d),s.push(k),w.push(k)}function j(a,b){if(a)for(var c=0,d=b.length;d>c;c++)b[c]&&m.utils.arrayForEach(b[c].mappedNodes,function(d){a(d,c,b[c].arrayEntry)})}e=e||[],g=g||{};for(var k,l,n,o=m.utils.domData.get(d,c)===b,p=m.utils.domData.get(d,c)||[],q=m.utils.arrayMap(p,function(a){return a.arrayEntry}),r=m.utils.compareArrays(q,e,g.dontLimitMoves),s=[],t=0,u=0,v=[],w=[],x=[],y=[],z=[],A=0;l=r[A];A++)switch(n=l.moved,l.status){case"deleted":n===b&&(k=p[t],k.dependentObservable&&k.dependentObservable.dispose(),v.push.apply(v,m.utils.fixUpContinuousNodeArray(k.mappedNodes,d)),g.beforeRemove&&(x[A]=k,w.push(k))),t++;break;case"retained":i(A,t++);break;case"added":n!==b?i(A,n):(k={arrayEntry:l.value,indexObservable:m.observable(u++)},s.push(k),w.push(k),o||(z[A]=k))}j(g.beforeMove,y),m.utils.arrayForEach(v,g.beforeRemove?m.cleanNode:m.removeNode);for(var B,C,A=0,D=m.virtualElements.firstChild(d);k=w[A];A++){k.mappedNodes||m.utils.extend(k,a(d,f,k.arrayEntry,h,k.indexObservable));for(var E=0;C=k.mappedNodes[E];D=C.nextSibling,B=C,E++)C!==D&&m.virtualElements.insertAfter(d,C,B);!k.initialized&&h&&(h(k.arrayEntry,k.mappedNodes,k.indexObservable),k.initialized=!0)}j(g.beforeRemove,x),j(g.afterMove,y),j(g.afterAdd,z),m.utils.domData.set(d,c,s)}}(),m.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",m.utils.setDomNodeChildrenFromArrayMapping),m.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},m.nativeTemplateEngine.prototype=new m.templateEngine,m.nativeTemplateEngine.prototype.constructor=m.nativeTemplateEngine,m.nativeTemplateEngine.prototype.renderTemplateSource=function(a){var b=!(m.utils.ieVersion<9),c=b?a.nodes:null,d=c?a.nodes():null;if(d)return m.utils.makeArray(d.cloneNode(!0).childNodes);var e=a.text();return m.utils.parseHtmlFragment(e)},m.nativeTemplateEngine.instance=new m.nativeTemplateEngine,m.setTemplateEngine(m.nativeTemplateEngine.instance),m.exportSymbol("nativeTemplateEngine",m.nativeTemplateEngine),function(){m.jqueryTmplTemplateEngine=function(){function a(){if(2>c)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function b(a,b,c){return f.tmpl(a,b,c)}var c=this.jQueryTmplVersion=function(){if("undefined"==typeof f||!f.tmpl)return 0;try{if(f.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(a){}return 1}();this.renderTemplateSource=function(c,e,g){g=g||{},a();var h=c.data("precompiled");if(!h){var i=c.text()||"";i="{{ko_with $item.koBindingContext}}"+i+"{{/ko_with}}",h=f.template(null,i),c.data("precompiled",h)}var j=[e.$data],k=f.extend({koBindingContext:e},g.templateOptions),l=b(h,j,k);return l.appendTo(d.createElement("div")),f.fragments={},l},this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"},this.addTemplate=function(a,b){d.write("<script type='text/html' id='"+a+"'>"+b+"<"+"/script>")},c>0&&(f.tmpl.tag.ko_code={open:"__.push($1 || '');"},f.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},m.jqueryTmplTemplateEngine.prototype=new m.templateEngine,m.jqueryTmplTemplateEngine.prototype.constructor=m.jqueryTmplTemplateEngine;var a=new m.jqueryTmplTemplateEngine;a.jQueryTmplVersion>0&&m.setTemplateEngine(a),m.exportSymbol("jqueryTmplTemplateEngine",m.jqueryTmplTemplateEngine)}()})}()}(),function(a,b){"use strict";function c(a,c){if(!a||"object"!=typeof a)throw new Error("When calling ko.track, you must pass an object as the first parameter.");var e=this,g=d(a,!0);return c=c||Object.getOwnPropertyNames(a),c.forEach(function(c){if(!(c in g)){var d=a[c],h=d instanceof Array,i=e.isObservable(d)?d:h?e.observableArray(d):e.observable(d);Object.defineProperty(a,c,{configurable:!0,enumerable:!0,get:i,set:e.isWriteableObservable(i)?i:b}),g[c]=i,h&&f(e,i)}}),a}function d(a,b){o||(o=q());var c=o.get(a);return!c&&b&&(c={},o.set(a,c)),c}function e(a,b,d){var e=this,f={owner:a,deferEvaluation:!0};if("function"==typeof d)f.read=d;else{if("value"in d)throw new Error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.');if("function"!=typeof d.get)throw new Error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".');f.read=d.get,f.write=d.set}return a[b]=e.computed(f),c.call(e,a,[b]),a}function f(a,b){var c=null;a.computed(function(){c&&(c.dispose(),c=null);var d=b();d instanceof Array&&(c=g(a,b,d))})}function g(a,b,c){var d=h(a,c);return d.subscribe(b)}function h(a,b){p||(p=q());var c=p.get(b);if(!c){c=new a.subscribable,p.set(b,c);var d={};i(b,c,d),j(a,b,c,d)}return c}function i(a,b,c){["pop","push","reverse","shift","sort","splice","unshift"].forEach(function(d){var e=a[d];a[d]=function(){var a=e.apply(this,arguments);return c.pause!==!0&&b.notifySubscribers(this),a}})}function j(a,b,c,d){["remove","removeAll","destroy","destroyAll","replace"].forEach(function(e){Object.defineProperty(b,e,{enumerable:!1,value:function(){var f;d.pause=!0;try{f=a.observableArray.fn[e].apply(a.observableArray(b),arguments)}finally{d.pause=!1}return c.notifySubscribers(b),f}})})}function k(a,b){if(!a||"object"!=typeof a)return null;var c=d(a,!1);return c&&c[b]||null}function l(a,b){var c=k(a,b);c&&c.valueHasMutated()}function m(a){a.track=c,a.getObservable=k,a.valueHasMutated=l,a.defineProperty=e}function n(){if("undefined"!=typeof module){var b=require("knockout"),c=require("weakmap");m(b),q=function(){return new c},module.exports=b}else"ko"in a&&(m(a.ko),q=function(){return new a.WeakMap})}var o,p,q;n()}(this),void function(a,b,c){function d(a,b,c){return"function"==typeof b&&(c=b,b=e(c).replace(/_$/,"")),i(a,b,{configurable:!0,writable:!0,value:c})
}function e(a){return"function"!=typeof a?"":"_name"in a?a._name:"name"in a?a.name:j.call(a).match(m)[1]}function f(a,b){return b._name=a,b}function g(a){function b(b,e){return e||2===arguments.length?d.set(b,e):(e=d.get(b),e===c&&(e=a(b),d.set(b,e))),e}var d=new o;return a||(a=p),b}var h=Object.getOwnPropertyNames,i=Object.defineProperty,j=Function.prototype.toString,k=Object.create,l=Object.prototype.hasOwnProperty,m=/^\n?function\s?(\w*)?_?\(/,n=function(){function a(){var a=j(),c={};this.unlock=function(d){var f=n(d);if(l.call(f,a))return f[a](c);var g=k(null,b);return i(f,a,{value:new Function("s","l",e)(c,g)}),g}}var b={value:{writable:!0,value:c}},e="return function(k){if(k===s)return l}",g=k(null),j=function(){var a=Math.random().toString(36).slice(2);return a in g?j():g[a]=a},m=j(),n=function(a){if(l.call(a,m))return a[m];if(!Object.isExtensible(a))throw new TypeError("Object must be extensible");var b=k(null);return i(a,m,{value:b}),b};return d(Object,f("getOwnPropertyNames",function(a){var b=h(a);return l.call(a,m)&&b.splice(b.indexOf(m),1),b})),d(a.prototype,f("get",function(a){return this.unlock(a).value})),d(a.prototype,f("set",function(a,b){this.unlock(a).value=b})),a}(),o=function(g){function h(b){return this===a||null==this||this===h.prototype?new h(b):(p(this,new n),r(this,b),void 0)}function i(a){o(a);var d=q(this).get(a);return d===b?c:d}function j(a,d){o(a),q(this).set(a,d===c?b:d)}function k(a){return o(a),q(this).get(a)!==c}function l(a){o(a);var b=q(this),d=b.get(a)!==c;return b.set(a,c),d}function m(){return q(this),"[object WeakMap]"}var o=function(a){if(null==a||"object"!=typeof a&&"function"!=typeof a)throw new TypeError("Invalid WeakMap key")},p=function(a,b){var c=g.unlock(a);if(c.value)throw new TypeError("Object is already a WeakMap");c.value=b},q=function(a){var b=g.unlock(a).value;if(!b)throw new TypeError("WeakMap is not generic");return b},r=function(a,b){null!==b&&"object"==typeof b&&"function"==typeof b.forEach&&b.forEach(function(c,d){c instanceof Array&&2===c.length&&j.call(a,b[d][0],b[d][1])})};i._name="get",j._name="set",k._name="has",m._name="toString";try{var s=("return "+l).replace("e_","\\u0065"),t=new Function("unwrap","validate",s)(q,o)}catch(u){var t=l}var s=(""+Object).split("Object"),v=f("toString",function(){return s[0]+e(this)+s[1]});d(v,v);var w={__proto__:[]}instanceof Array?function(a){a.__proto__=v}:function(a){d(a,v)};return w(h),[m,i,j,k,t].forEach(function(a){d(h.prototype,a),w(a)}),h}(new n),p=Object.create?function(){return Object.create(null)}:function(){return{}};"undefined"!=typeof module?module.exports=o:"undefined"!=typeof exports?exports.WeakMap=o:"WeakMap"in a||(a.WeakMap=o),o.createStorage=g,a.WeakMap&&(a.WeakMap.createStorage=g)}((0,eval)("this")),function(a,b,c){"undefined"!=typeof module?module.exports=c(a,b):"function"==typeof define&&"object"==typeof define.amd?define(c):b[a]=c(a,b)}("radio",this,function(a,b){"use strict";function c(a){return c.$.channel(a),c.$}return c.$={version:"0.2",channelName:"",channels:[],broadcast:function(){var a,c,d,e,f=this.channels[this.channelName],g=f.length;for(a=0;g>a;a++)c=f[a],"object"==typeof c&&c.length&&(d=c[0],e=c[1]||b),d.apply(e,arguments);return this},channel:function(a){var b=this.channels;return b[a]||(b[a]=[]),this.channelName=a,this},subscribe:function(){var a,b,c=arguments,d=this.channels[this.channelName],e=c.length,f=[];for(a=0;e>a;a++)f=c[a],b="function"==typeof f?[f]:f,"object"==typeof b&&b.length&&d.push(b);return this},unsubscribe:function(){var a,b,c,d=arguments,e=this.channels[this.channelName],f=d.length,g=e.length,h=0;for(a=0;f>a;a++)for(h=0,g=e.length,b=0;g>b;b++)c=b-h,e[c][0]===d[a]&&(e.splice(c,1),h++);return this}},c}),!function(a,b,c){"undefined"!=typeof module?module.exports=c(a,b):"function"==typeof define&&"object"==typeof define.amd?define(c):b[a]=c(a,b)}("humane",this,function(){var a=window,b=document,c={on:function(b,c,d){"addEventListener"in a?b.addEventListener(c,d,!1):b.attachEvent("on"+c,d)},off:function(b,c,d){"removeEventListener"in a?b.removeEventListener(c,d,!1):b.detachEvent("on"+c,d)},bind:function(a,b){return function(){a.apply(b,arguments)}},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},config:function(a,b){return null!=a?a:b},transSupport:!1,useFilter:/msie [678]/i.test(navigator.userAgent),_checkTransition:function(){var a=b.createElement("div"),c={webkit:"webkit",Moz:"",O:"o",ms:"MS"};for(var d in c)d+"Transition"in a.style&&(this.vendorPrefix=c[d],this.transSupport=!0)}};c._checkTransition();var d=function(b){b||(b={}),this.queue=[],this.baseCls=b.baseCls||"humane",this.addnCls=b.addnCls||"",this.timeout="timeout"in b?b.timeout:2500,this.waitForMove=b.waitForMove||!1,this.clickToClose=b.clickToClose||!1,this.timeoutAfterMove=b.timeoutAfterMove||!1,this.container=b.container;try{this._setupEl()}catch(d){c.on(a,"load",c.bind(this._setupEl,this))}};return d.prototype={constructor:d,_setupEl:function(){var a=b.createElement("div");if(a.style.display="none",!this.container){if(!b.body)throw"document.body is null";this.container=b.body}this.container.appendChild(a),this.el=a,this.removeEvent=c.bind(function(){this.timeoutAfterMove?setTimeout(c.bind(this.remove,this),this.timeout):this.remove()},this),this.transEvent=c.bind(this._afterAnimation,this),this._run()},_afterTimeout:function(){c.config(this.currentMsg.waitForMove,this.waitForMove)?this.removeEventsSet||(c.on(b.body,"mousemove",this.removeEvent),c.on(b.body,"click",this.removeEvent),c.on(b.body,"keypress",this.removeEvent),c.on(b.body,"touchstart",this.removeEvent),this.removeEventsSet=!0):this.remove()},_run:function(){if(!this._animating&&this.queue.length&&this.el){this._animating=!0,this.currentTimer&&(clearTimeout(this.currentTimer),this.currentTimer=null);var a=this.queue.shift(),b=c.config(a.clickToClose,this.clickToClose);b&&(c.on(this.el,"click",this.removeEvent),c.on(this.el,"touchstart",this.removeEvent));var d=c.config(a.timeout,this.timeout);d>0&&(this.currentTimer=setTimeout(c.bind(this._afterTimeout,this),d)),c.isArray(a.html)&&(a.html="<ul><li>"+a.html.join("<li>")+"</ul>"),this.el.innerHTML=a.html,this.currentMsg=a,this.el.className=this.baseCls,c.transSupport?(this.el.style.display="block",setTimeout(c.bind(this._showMsg,this),50)):this._showMsg()}},_setOpacity:function(a){if(c.useFilter)try{this.el.filters.item("DXImageTransform.Microsoft.Alpha").Opacity=100*a}catch(b){}else this.el.style.opacity=String(a)},_showMsg:function(){var a=c.config(this.currentMsg.addnCls,this.addnCls);if(c.transSupport)this.el.className=this.baseCls+" "+a+" "+this.baseCls+"-animate";else{var b=0;this.el.className=this.baseCls+" "+a+" "+this.baseCls+"-js-animate",this._setOpacity(0),this.el.style.display="block";var d=this,e=setInterval(function(){1>b?(b+=.1,b>1&&(b=1),d._setOpacity(b)):clearInterval(e)},30)}},_hideMsg:function(){var a=c.config(this.currentMsg.addnCls,this.addnCls);if(c.transSupport)this.el.className=this.baseCls+" "+a,c.on(this.el,c.vendorPrefix?c.vendorPrefix+"TransitionEnd":"transitionend",this.transEvent);else var b=1,d=this,e=setInterval(function(){b>0?(b-=.1,0>b&&(b=0),d._setOpacity(b)):(d.el.className=d.baseCls+" "+a,clearInterval(e),d._afterAnimation())},30)},_afterAnimation:function(){c.transSupport&&c.off(this.el,c.vendorPrefix?c.vendorPrefix+"TransitionEnd":"transitionend",this.transEvent),this.currentMsg.cb&&this.currentMsg.cb(),this.el.style.display="none",this._animating=!1,this._run()},remove:function(a){var d="function"==typeof a?a:null;c.off(b.body,"mousemove",this.removeEvent),c.off(b.body,"click",this.removeEvent),c.off(b.body,"keypress",this.removeEvent),c.off(b.body,"touchstart",this.removeEvent),c.off(this.el,"click",this.removeEvent),c.off(this.el,"touchstart",this.removeEvent),this.removeEventsSet=!1,d&&this.currentMsg&&(this.currentMsg.cb=d),this._animating?this._hideMsg():d&&d()},log:function(a,b,c,d){var e={};if(d)for(var f in d)e[f]=d[f];if("function"==typeof b)c=b;else if(b)for(var f in b)e[f]=b[f];return e.html=a,c&&(e.cb=c),this.queue.push(e),this._run(),this},spawn:function(a){var b=this;return function(c,d,e){return b.log.call(b,c,d,e,a),b}},create:function(a){return new d(a)}},new d}),function(){function basicPluralize(a){return/[x|s]$/.test(a)?a+"es":CONS_Y.test(a)?a.substring(0,a.length-1)+"ies":a+"s"}function copy(a,b){for(var c in b)a[c]=b[c];return a}window.ion=window.ion||{};var DIE_PARSER=/\d+d\d+/g,FORMAT_PARSER=/\{[^\|}]+\}/g,RANDOM_STRING=/\{[^\{\}]*\|[^\{\}]*\}/g,STARTS_WITH_VOWEL=/^[aeiouAEIOU]/,STARTS_WITH_THE=/^[tT]he\s/,SMALL_WORDS=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i,PARENS=/(\{[^\}]*\})/g,CONS_Y=/[BCDFGHIJKLMNPQRSTVWXZbcdfghijklmnpqrstvwxz]y$/,lgv=null,slice=Array.prototype.slice,indexOf=Array.prototype.indexOf,filter=Array.prototype.filter,map=Array.prototype.map,forEach=Array.prototype.forEach;["Array","Function","String","Date","RegExp","Boolean","Number","Object"].forEach(function(a){window.ion["is"+a]=function(b){return Object.prototype.toString.call(b)==="[object "+a+"]"}}),copy(window.ion,{isUndefined:function(a){return"undefined"==typeof a},extend:copy,identity:function(a){return a},transform:function(a){return a()},contains:function(a,b){return a?indexOf.call(a,b)>-1:!1},find:function(a,b,c){for(var d=0;d<a.length;d++)if(b.call(c||window,a[d]))return a[d];return null},keys:function(a){return ion.isObject(a)?Object.keys(a):[]},values:function(a){return ion.keys(a).map(function(b){return a[b]})},times:function(a,b,c){for(var d=0;a>d;d++)b.call(c||window,d,a)},last:function(a){return a&&a.length?a[a.length-1]:null},unique:function(a){if(0===arguments.length||0===a.length)return[];var b=[];return filter.call(a,function(a){return-1===b.indexOf(a)?!!b.push(a):void 0}),b},intersection:function(a,b){if(2!==arguments.length)return[];a=slice.call(a,0),b=slice.call(b,0);for(var c=[],d=0;d<a.length;d++)b.indexOf(a[d])>-1&&-1===c.indexOf(a[d])&&(c[c.length]=a[d]);return c},union:function(a,b){return 2!==arguments.length?[]:(a=slice.call(a,0),b=slice.call(b,0),ion.unique(a.concat(b)))},without:function(a){var b=slice.call(arguments,1);return filter.call(a||[],function(a){return-1===b.indexOf(a)})},define:function(a,b){1===arguments.length&&(b=a,a=null);var c=b.init||function(){};if(a){var d=function(){};d.prototype=a.prototype,c.prototype=new d}if(b.properties){for(var e in b.properties)Object.defineProperty(c.prototype,e,{enumerable:!1,configurable:!1,get:b.properties[e]});delete b.properties}delete b.init;for(var f in b)c.prototype[f]=b[f];return c.prototype.constructor=c,c},bounded:function(a,b,c){return c=c||Number.MAX_VALUE,b>a?b:a>c?c:a},sum:function(a){return(a||[]).reduce(function(a,b){return"number"==typeof b&&(a+=b),a},0)},article:function(a){return STARTS_WITH_THE.test(a)?a:STARTS_WITH_VOWEL.test(a)?"an "+a:"a "+a},format:function(a,b){return"undefined"==typeof b?a:((arguments.length>2||"object"!=typeof b)&&(b=slice.call(arguments),a=b.shift()),a.replace(FORMAT_PARSER,function(a){var c=a.substring(1,a.length-1);return"function"==typeof b[c]?b[c]():b[c]}))},pluralize:function(a,b){a=a instanceof ion.models.Item?a.name:a,b=b||1;var c={singular:"",plural:""},d="{|"!==a.substring(0,2);return b>1&&(c.plural+=b+" "),-1===a.indexOf("{")?(c.singular=a,c.plural+=basicPluralize(a)):a.split(PARENS).forEach(function(a){if(-1===a.indexOf("{"))c.singular+=a,c.plural+=a;else if(-1===a.indexOf("|"))c.plural+=a.substring(1,a.length-1);else{var b=a.substring(1,a.length-1).split("|");c.singular+=b[0],c.plural+=b[1]}}),d&&(c.singular=ion.article(c.singular)),1===b?c.singular:c.plural},sentenceCase:function(a){return ion.isString(a)?a.substring(0,1).toUpperCase()+a.substring(1):a},titleCase:function(a){return a.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(a,b,c){return b>0&&b+a.length!==c.length&&a.search(SMALL_WORDS)>-1&&":"!==c.charAt(b-2)&&("-"!==c.charAt(b+a.length)||"-"===c.charAt(b-1))&&c.charAt(b-1).search(/[^\s-]/)<0?a.toLowerCase():a.substr(1).search(/[A-Z]|\../)>-1?a:a.charAt(0).toUpperCase()+a.substr(1)})},toTag:function(a){return ion.isString(a)?a.toLowerCase().replace(/\s/g,""):a},toList:function(a,b){b=b||function(a){return a.toString()};var c=a.length;if(0===c)return"";if(1===c)return b(a[0]);if(2===c)return b(a[0])+" and "+b(a[1]);var d=a.map(b);return d[d.length-1]="and "+d[d.length-1],d.join(", ")},random:function(a){if(ion.isString(a))return a.replace(RANDOM_STRING,function(a){return ion.random(a.substring(1,a.length-1).split("|"))});if(ion.isArray(a))return a.length?a[~~(Math.random()*a.length)]:null;if(ion.isNumber(a))return ion.roll(a);throw new Error("Invalid value: "+a)},roll:function(value){if(3===arguments.length)return ion.roll(ion.format("{0}d{1}+{2}",arguments[0],arguments[1],arguments[2]));if(2===arguments.length)return ion.roll(ion.format("{0}d{1}",arguments[0],arguments[1]));if("number"==typeof value)return value>0?~~(Math.random()*value)+1:0;if("string"==typeof value){value=value.replace(DIE_PARSER,function(a){for(var b=a.split("d"),c=parseInt(b[0],10),d=parseInt(b[1],10),e=0,f=0;c>f;f++)e+=~~(Math.random()*d)+1;return e});try{return eval(value)}catch(e){return 0}}throw new Error("Invalid value: "+value)},select:function(a){return ion.isArray(a)?ion.select(ion.random(a)):ion.isFunction(a)?ion.select(a()):a},shuffle:function(a){for(var b,c,d=a.length-1;d>0;d--)b=~~(Math.random()*(d+1)),c=a[d],a[d]=a[b],a[b]=c},test:function(a){if(0>a||a>100)throw new Error("Percentage must be between 0 and 100");return ion.roll(100)<=a},gaussian:function(a,b){var c,d,e=0,f=0,g=b||0;if(lgv){var h=lgv;return lgv=null,Math.round(h*a)+g}do e=2*Math.random()-1,f=2*Math.random()-1,c=e*e+f*f;while(0===c||c>1);return d=Math.sqrt(-2*Math.log(c)/c),lgv=f*d,Math.round(e*d*a)+g},nonNegativeGaussian:function(a,b){var c;do c=ion.gaussian(a,b);while(0>c);return c},addIfSet:function(a,b,c,d,e){if(a=a||{},!ion.isUndefined(c)&&null!==c&&""!==c&&(!ion.isString(c)||"either"!==c.toLowerCase()&&"any"!==c.toLowerCase())){if(!d||ion.contains(d,c))return a[b]=c,a;if(e)throw new Error("Value '"+c+"' not in values: "+d.join(", "))}}})}(),ion.Builder=function(){function a(a,b){var c=this.context;(a||[]).forEach(function(a,c){this.context=a,b.call(this.context,this,a,c)},this),this.context=c}function b(){1===arguments.length?this.str+=arguments[0]:arguments[1]&&(this.str+=ion.format.apply(this.context,arguments))}function c(a,b,c){a?b.call(this.context,this):c.call(this.context,this)}function d(a,b){a&&b.call(this.context,this)}function e(a,b,c){this.str+="<"+a;for(var d in b)this.str+=" "+d+'="'+b[d]+'"';this.str+=">",c.call(this.context,this),this.str+="</"+a+">"}function f(a,b,c){this.str+="<"+a;for(var d in b)this.str+=" "+d+'="'+b[d]+'"';this.str+=">"+c+"</"+a+">"}function g(a,b){a&&(this.str+=b)}function h(a,b){this.str+=ion.pluralize(a,b)}function i(){return this.str}var j=Array.prototype.map;return function(k){if(!k)throw new Error("No context obj to Builder");var l=function(){var i=j.call(arguments,function(a){return a instanceof Array?"a":(typeof a).substring(0,1)}).join("");switch(i){case"af":a.apply(l,arguments);break;case"bf":d.apply(l,arguments);break;case"bff":c.apply(l,arguments);break;case"bs":g.apply(l,arguments);break;case"sof":e.apply(l,arguments);break;case"sos":f.apply(l,arguments);break;case"sn":h.apply(l,arguments);break;default:b.apply(l,arguments)}return l};return l.context=k,l.str="",l.toString=i,l}}(),function(a){function b(){this.value=[].reduce.call(this,function(a,b){return a+b.value},0)}a.dice=a.dice||{},a.dice.Die=a.define({init:function(a,b){this.faces=a,this.color=b,this.roll()},roll:function(){return this.value=a.roll(this.faces),this.value},symbol:function(){return this.value.toString()},toString:function(){return a.format("[{0} {1}]",this.color,this.symbol())}}),a.dice.FudgeDie=a.define(a.dice.Die,{init:function(b){a.dice.Die.call(this,6,b)},roll:function(){return this.value=a.roll(3)-2,this.value},symbol:function(){return-1===this.value?"-":1===this.value?"+":" "}}),a.dice.Dice=a.define({init:function(){this.length=arguments.length;var c=arguments[0];c&&(c.length||a.isArray(c)?a.extend(this,c):a.extend(this,arguments)),b.call(this)},push:function(a){this[this.length++]=a,b.call(this)},roll:function(){return[].map.call(this,function(a){return a.roll()}),b.call(this),this.value},toString:function(){return[].map.call(this,function(a){return a.toString()}).join(" ")}})}(ion),function(a){a.tables=a.tables||{},a.tables.Table=a.define({init:function(b){this.outFunction=b||a.identity,this.rows=[],this.sum=0},add:function(){var a,b,c,d;if(3===arguments.length){if(a=arguments[0],b=arguments[1],c=arguments[2],d=b-a+1,1>a||a>100||1>b||b>100)throw new Error("Dice ranges must be from 1 to 100")}else if(d=arguments[0],c=arguments[1],1>d||d>100)throw new Error("Dice ranges must be from 1 to 100");if("undefined"==typeof c)throw new Error("Object is undefined");return this.rows.push({chance:d,object:c}),this.sum+=d,this},get:function(){if(100!==Math.round(this.sum))throw Error("Table elements do not add up to 100%, but rather to "+Math.round(this.sum));for(var b=a.roll(100),c=0,d=this.rows.length;d>c;c++){if(b<=this.rows[c].chance)return this.outFunction(this.rows[c].object);b-=this.rows[c].chance}},size:function(){return this.rows.length}})}(ion),function(a){a.tables.RarityTable=a.define(a.tables.Table,{init:function(b,c){this.common=[],this.uncommon=[],this.rare=[],1===arguments.length&&(c=b),b=a.isFunction(b)?b:a.identity,this.useStrict=a.isBoolean(c)?c:!0,a.tables.Table.call(this,b)},add:function(a,b){switch(a){case"common":case"uncommon":case"rare":this[a].push(b),this.rows.push(b);break;default:throw new Error(a+" is not valid (use rare, uncommon, common)")}return this},get:function(){if(this.useStrict&&(0===this.rare.length||0===this.common.length||0===this.uncommon.length))throw new Error("RarityTable must have at least one common, uncommon, and rare element");var b=this.common.length?65:0,c=this.uncommon.length?30:0,d=this.rare.length?5:0,e=a.roll(b+c+d);return b>=e&&0!==b?this.outFunction(a.random(this.common)):b+c>=e&&0!==c?this.outFunction(a.random(this.uncommon)):b+c+d>=e&&0!==d?this.outFunction(a.random(this.rare)):null}})}(ion),function(a){a.tables.HashTable=a.define({init:function(b){this.outFunction=b||a.identity,this.hash={}},put:function(){for(var a=arguments[arguments.length-1],b=0;b<arguments.length-1;b++)this.hash[arguments[b]]=a;return this},get:function(a){var b=this.hash[a];return b?this.outFunction(b):this.hash["default"]?this.outFunction(this.hash["default"]):null}})}(ion),ion.models=ion.models||{},ion.models.Model=ion.define({init:function(a){if(this.tags=[],ion.isObject(a))for(var b in a)this[b]=a[b];this.type="ion.models.Model"},is:function(a){return-1!==this.tags.indexOf(a)},has:function(a){return-1!==this.tags.indexOf(a)},not:function(a){return-1===this.tags.indexOf(a)},typeOf:function(a){var b=a+":";return this.tags.filter(function(a){return a.indexOf(b)>-1})[0]},clone:function(){return ion.models.Model.create(JSON.stringify(this))}}),ion.models.Model.create=function(a,b){if(b!==!0&&ion.isString(a)&&(a=JSON.parse(a)),ion.isObject(a)||ion.isArray(a)){if(a.type){var c=window;a.type.split(".").forEach(function(a){c=c[a]}),a=new c(a)}for(var d in a)a[d]=ion.models.Model.create(a[d],!0)}return a},ion.models.IonSet=ion.define({init:function(a){this.hash={};for(var b=0;b<(a||[]).length;b++)this.add(a[b])},clear:function(){this.hash={}},add:function(a){this.hash[a.toString()]=a},remove:function(a){delete this.hash[a.toString()]},has:function(a){return"undefined"!=typeof this.hash[a.toString()]},size:function(){return ion.keys(this.hash).length},toArray:function(){return ion.values(this.hash)}}),ion.models.Item=ion.define(ion.models.Model,{init:function(a){a=ion.isString(a)?{name:a}:a,this.tags=[],this.name=a.name,this.enc=0,this.value=0,ion.models.Model.call(this,a),this.type="ion.models.Item"}}),function(a,b,c){function d(a,b){return a.item.name>b.item.name?1:a.item.name<b.item.name?-1:0}function e(a){return this.entries.filter(function(b){return b.item.name===a.name})[0]}function f(a){return"string"==typeof a?new b({name:a}):a}function g(a){return"number"==typeof a?a:1}function h(a,b){return a=f(a),this.entries.filter(function(b){return!a||a.name===b.item.name}).reduce(function(a,c){var d=b?c.item[b]:1;return a+d*c.count},0)}a.models.Bag=a.define(c,{init:function(a){c.call(this,a),this.entries=this.entries||[],this.type="ion.models.Bag"},addBag:function(a){(a&&a.clone().entries||[]).forEach(function(a){this.add(a.item,a.count)},this)},removeBag:function(a){(a&&a.clone().entries||[]).forEach(function(a){this.remove(a.item,a.count)},this)},add:function(a,b){if(!a)throw new Error("No item passed to bag.add()");a=f(a),b=g(b);var c=e.call(this,a);if(0>b)throw new Error("Can't add negative items to bag: "+b);return c||(c={item:a,count:0},this.entries.push(c)),c.count+=b,c.count},sort:function(a){this.entries.sort(a||d)},remove:function(a,b){a=f(a),b=g(b);var c=e.call(this,a);if(!c)throw new Error("Can't remove item that's not in the bag");if(0>=b)throw new Error("Can't remove a negative number of items from bag: "+b);if(b>c.count)throw new Error("Can't remove "+b+" items in bag that has only "+c.count);return c.count-=b,0===c.count&&this.entries.splice(this.entries.indexOf(c),1),c.count},filter:function(b){for(var c=new a.models.Bag,d=this.entries.length-1;d>=0;d--){var e=this.entries[d];if(b.call(this,e.item,e.count)){var f=e.item,g=e.count;this.remove(f,g),c.add(f,g)}}return c},value:function(a){return h.call(this,a,"value")},enc:function(a){return h.call(this,a,"enc")},count:function(a){return h.call(this,a)},typeOf:function(a){return this.entries.reduce(function(b,c){return c.item.typeOf(a)&&b.push(c.item),b},[])}})}(ion,ion.models.Item,ion.models.Model),ion.models.Name=ion.define(ion.models.Model,{init:function(a){ion.models.Model.call(this,a),this.type="ion.models.Name"},toString:function(){return this.nickname?this.nickname:ion.format("{given} {family}",this)}}),ion.models.Character=ion.define(ion.models.Model,{init:function(a){this.gender="male",this.age=0,this.honorific=null,this.degree=null,this.inventory=new ion.models.Bag,this.traits={},this.history=[],ion.models.Model.call(this,a),this.type="ion.models.Character"},properties:{male:function(){return"male"===this.gender},points:function(){return ion.sum(ion.values(this.traits))},personal:function(){return"male"===this.gender?"he":"she"},objective:function(){return"male"===this.gender?"him":"her"},reflexive:function(){return"male"===this.gender?"himself":"herself"},possessive:function(){return"male"===this.gender?"his":"her"}},changeTrait:function(a,b){b=b||0,this.traits[a]=this.traits[a]||0,this.traits[a]+=b,this.traits[a]<=0&&delete this.traits[a]},trait:function(a){return this.traits[a]||0}}),function(a){function b(a,b,c){a[b]||(a[b]=c)}var c=4;a.models.Profession=a.define(a.models.Model,{init:function(b){this.names=b.name?[b.name]:[],this.seeds=[],this.supplements=[],this.tags=[],this.postprocess=a.identity,a.models.Model.call(this,b),this.type="ion.models.Profession"},train:function(d,e){var f={};this.seeds.forEach(function(a){d.trait(a)<c&&(b(f,a,1),e--)});var g=Math.ceil(e/4)-this.seeds.length+a.roll("1d2");a.shuffle(this.supplements),this.supplements.forEach(function(a,c){g>=c&&b(f,a,0)});for(var h=a.keys(f);e>0&&h.length;){var i=a.random(h);f[i]+d.trait(i)>=c?h=a.without(h,i):(f[i]++,e--)}for(var j in f)f[j]>0&&d.changeTrait(j,f[j]);this.tags.forEach(function(a){d.tags.push(a)}),this.postprocess(d)}})}(ion),ion.models.Gang=ion.define(ion.models.Model,{init:function(a){this.members=[],ion.models.Model.call(this,a),this.type="ion.models.Gang"},add:function(a){this.members.push(a)}}),ion.models.Weather=ion.define(ion.models.Model,{init:function(a){ion.models.Model.call(this,a),this.type="ion.models.Weather"}}),ion.models.Family=ion.define({init:function(a){this.children=[],this.couples=[],ion.models.Model.call(this,a),this.type="ion.models.Family"},properties:{childCount:function(){return this.children.length+this.couples.length},male:function(){return this.parent.male?this.parent:this.other},female:function(){return this.parent.male?this.other:this.parent},single:function(){return this.parent.status&&!this.other.status?this.other:this.other.status&&!this.parent.status?this.parent:null}},isParent:function(a){return a===this.parent||a===this.other}}),ion.models.Relationship=function(a,b,c){this.older=a,this.younger=b,this.relationship=c},ion.models.Store=ion.define(ion.models.Model,{init:function(a){this.name=null,this.owner=null,this.onhand=null,this.inventory=new ion.models.Bag,ion.models.Model.call(this,a),this.type="ion.models.Store"}}),function(a,b,c){function d(b,c){var e=1===b.ands.length&&"*"===b.ands[0]||a.intersection(c.tags,b.ands).length===b.ands.length&&0===a.intersection(c.tags,b.nots).length;return!e&&a.contains(b.ands,c.searchName)&&(e=!0),!e&&b.or?d(b.or,c):e}function e(c){for(var e=new b(a.identity,!1),f=0,g=this.models.length;g>f;f++){var h=a.random(this.models[f]);d(c,h)&&this.strategy.matches(c,h)&&e.add(h.frequency,h)}return e}function f(){return{ands:[],nots:[]}}function g(a){return a.trim().toLowerCase().split(/\s+/)}function h(b){var c=f();return a.isString(b)&&""!==b&&(c=g(b).reduce(this.cbTagCollector,c)),c.ands}function i(a,b){if("|"===b){var c=f();return a.or=c,c}return this.lookupArray&&(b=this.lookupArray[parseInt(b,10)]||b),"-"===b.charAt(0)?a.nots.push(b.substring(1)):a.ands.push(b),a}function j(b,c){if(a.isString(c)&&""!==c)b=g(c).reduce(this.cbTagCollector,b);else if(a.isArray(c))for(var d=0;d<c.length;d++)b=g(c[d]).reduce(this.cbTagCollector,b)}function k(a){return a=a.replace(/\{.*\}|\(.*\)/g,""),a.replace(/\W|\s/g,"").toLowerCase()}a.models.Database=a.define({init:function(b,c){this.models=[],this.lookupArray=b||[],this.cbTagCollector=i.bind(this),this.strategy=c||{buildQuery:function(){return!1},finishQuery:a.identity,matches:a.identity}},register:a.identity,parseQuery:function(){if(!a.isUndefined(arguments[0])&&arguments[0].ands)return arguments[0];for(var b=f(),c=0;c<arguments.length;c++)this.strategy.buildQuery(b,arguments[c])||j.call(this,b,arguments[c]);return this.strategy.finishQuery(b),b},find:function(){return this.findAll.apply(this,arguments).get()},findAll:function(){var a=this.parseQuery.apply(this,arguments);return e.call(this,a)}}),a.models.ItemDatabase=a.define(a.models.Database,{init:function(b){a.models.Database.call(this,b,{buildQuery:function(b,c){if(a.isObject(c))b.conditions=c;else if(a.isNumber(c))b.totalValue=c;else{if(!a.isBoolean(c))return!1;b.fillBag=c}return!0},finishQuery:function(b){if(b.fillBag=a.isBoolean(b.fillBag)?b.fillBag:!0,b.totalValue=a.isNumber(b.totalValue)?b.totalValue:20,b.conditions=a.extend({minValue:0,maxValue:Number.MAX_VALUE,minEnc:0,maxEnc:Number.MAX_VALUE},b.conditions||{}),b.conditions.maxValue<=0||b.conditions.maxEnc<=0||b.conditions.minValue>b.conditions.maxValue||b.conditions.minEnc>b.conditions.maxEnc)throw new Error("Conditions cannot match any taggable: "+JSON.stringify(b.conditions));if(!a.isUndefined(b.totalValue)&&b.totalValue<=0)throw new Error("Bag value must be more than 0")},matches:function(a,b){var c=a.conditions;return b.value>=c.minValue&&b.value<=c.maxValue&&b.enc>=c.minEnc&&b.enc<=c.maxEnc}})},register:function(){for(var b=0,d=arguments.length;d>b;b++){for(var e=arguments[b],f=e.split("!"),g=f[0].trim().split(";"),i=h.call(this,f[3]),j=i.indexOf("br")>-1,l={value:parseFloat(f[1]),enc:parseFloat(f[2]),frequency:i.shift(),tags:a.without(i,"br")},m=this.models[this.models.length]=[],n=0,o=g.length;o>n;n++)l.name=g[n].trim(),l.searchName=k(l.name),m[m.length]=new c(l);if(j)for(l.tags=l.tags.concat(["br"]),l.value=Math.max(1,~~(l.value/2)),m=this.models[this.models.length]=[],n=0,o=g.length;o>n;n++)l.name="broken "+g[n].trim(),l.searchName=k(l.name),m[m.length]=new c(l)}}}),a.models.ProfessionDatabase=a.define(a.models.Database,{init:function(b){a.models.Database.call(this,b)},register:function(){for(var b=arguments[0],c=1,d=arguments.length;d>c;c+=2){for(var e=arguments[c].split("!"),f=e[0].trim().split(/\s*;\s*/),g=h.call(this,e[1]),i=h.call(this,e[2]),j=h.call(this,e[3]),k=j.shift(),l=arguments[c+1]?new Function("c",arguments[c+1]):a.identity,m=0;m<f.length;m++)j[j.length]=a.toTag(f[m]);this.models[this.models.length]=[new b({names:f,tags:j,seeds:g,supplements:i,postprocess:l,frequency:k})]}}}),a.models.EncounterDatabase=a.define(a.models.Database,{init:function(b){a.models.Database.call(this,b)},register:function(){for(var a=0,b=arguments.length;b>a;a++)arguments[a].split("!"),this.models[this.models.length]=[]}})}(ion,ion.tables.RarityTable,ion.models.Item),function(a,b,c){function d(b){var c=b.single;return null!==c?a.format("{0} ({1}), {2}. ",c.name.toString(),c.age,b.relationship):e(b.male,b.female,b.relationship)}function e(b,c,d){return b.name.family===c.name.family?a.format("{0} ({1}) & {2} ({3}) {4} ({5}). ",b.name.given,b.age,c.name.given,c.age,b.name.family,d):a.format("{0} ({1}) & {2} ({3}). {4}. ",b.name.toString(),b.age,c.name.toString(),c.age,a.sentenceCase(d))}function f(b){return Object.keys(b).sort(function(a,b){return b>a?-1:a>b?1:0}).map(function(c){return a.format("{0} {1}",c,b[c])}).join(", ")}function g(b){return b("{0} ",this.honorific),b(this.name.toString()),b(", {0}",this.degree),b(!this.honorific&&!!this.profession,", "+this.profession),b(". "),b(!!this.status,function(b){b("{0} (would be {1}). ",a.sentenceCase(this.status),this.age)},function(a){a("Age {0}. ",this.age+"")}),b("{0}. ",this.appearance),b("{0}. ",this.history.join(", ")),b}function h(a){return a(!!this.name,function(a){a("The {0} ({1} members): ",this.name,this.members.length)},function(a){a("{0} member {1}: ",this.members.length,this.kind)}),a}function i(a,b){var c={};return atomic.getCombatTraits().forEach(function(a){b.trait(a)>0&&(c[a]=b.trait(a))}),g.call(this,a)("{0}. ",f(c))("Possessions: {0}",this.inventory.toString()).toString()}var j=a.renderers={};j.characterString=function(){var a=c(this);return g.call(this,a)("{0}. ",f(this.traits))("Possessions: {0}",this.inventory.toString()).toString()},j.characterHTML=function(){var a=c(this);return a("p",{},function(a){g.call(this,a)}),a("p",{},function(a){a("{0}. ",f(this.traits))}),a(!!this.inventory.length,function(a){a("p",{},function(a){a("Possessions: {0}",this.inventory.toString())})}),a.toString()},j.familyHTML=function(){var a=c(this);return a("div",{"class":"family"},function(a){a("div",{"class":"pair"},function(a){a(d(this)),a("span",{"class":"pair_detail"},function(a){a(!!this.single,function(){a(j.characterString.call(this.single))},function(){a(j.characterString.call(this.male)),a(" "),a(j.characterString.call(this.female))})})}),a(!!this.childCount,function(a){a("div",{"class":"children_preamble"},function(a){a("{|}{1 |}child{ren}:",this.childCount)}),a("div",{"class":"children"},function(a){a(this.children,function(a,b){a("div",{"class":"child"},function(a){a(j.characterString.call(b))})}),a(this.couples,function(a,b){a(j.familyHTML.call(b))})})})}),a.toString()},j.familyString=function(){return c(this)(e(this.male,this.female,this.relationship))(!!this.childCount,function(a){a("{|}{1 |}child{ren}: ",this.childCount),a(this.children,function(a,b,c){a(c>0," ")(b.toString())}),a(this.couples,function(a,b,c){a(c>0," ")(b.toString())})}).toString()},j.relString=function(){return e(this.older,this.younger,this.relationship)},j.relHTML=function(){var a=c(this);return a("p",{},function(a){a(e(this.older,this.younger,this.relationship))}),a("p",{},function(a){a(j.characterString.call(this.older))})(" "),a("p",{},function(a){a(j.characterString.call(this.younger))}),a.toString()},j.weatherString=function(){return a.format("Nightly low of {low}, high of {high}, {rain}",this)},j.weatherHTML=function(){return'<p class="weather">'+this.toString()+".</p>"},j.itemString=function(){return a.pluralize(this.name)
},j.itemHTML=function(){return"<p>"+a.pluralize(this.name)+"</p>"},j.gangString=function(){var a=c(this);return h.call(this,a),a(this.members,function(a,b){i.call(b,a,b)}).toString()},j.gangHTML=function(){var a=c(this);return a("p",{},function(a){h.call(this,a)}),a(this.members,function(a,b){a("p",{},function(a){i.call(b,a,b)})}),a.toString()},j.bagString=function(){var b="",c=0;if(this.entries.length){var d=!1,e=this.entries.filter(function(a){return a.item.not("cash")}).length;this.entries.forEach(function(f){f.item.is("cash")?c+=100*f.item.value*f.count:(d=!0,b+=a.pluralize(f.item,f.count),b+=1===e?".":2===e?", and ":", ",e--)},this),d&&c&&(b+=" "),c&&(b+="$"+c.toFixed(0)+" in cash."),b=a.sentenceCase(b)}return this.descriptor&&(b=this.descriptor+". "+b),b},j.bagHTML=function(){return'<p class="bag">'+this.toString()+"</p>"},j.storeString=function(){var a=c(this);return a(this.name)(". "),a("Owner(s): "+this.owner.toString()),a("Inventory: "+this.inventory.toString())(" "),a("Cash on hand: "+this.onhand.toString()),a.toString()},j.storeHTML=function(){var b=c(this);return b("p",{"class":"title"},this.name),b("div",{"class":"owner"},function(a){a("p",{"class":"title"},function(a){a("Owner(s)")}),a(this.owner.toHTML())}),b("p",{"class":"title"},"For Trade"),b("ul",{"class":"inventory"},function(b){b(this.inventory.entries,function(b,c){var d=a.pluralize(c.item.name,c.count)+" ("+a.pluralize("trade",c.item.value)+" each)";b("li",{},d)})}),b("p",{},this.onhand.toString()),b.toString()},b.Bag.prototype.toString=j.bagString,b.Bag.prototype.toHTML=j.bagHTML,b.Character.prototype.toString=j.characterString,b.Character.prototype.toHTML=j.characterHTML,b.Family.prototype.toString=j.familyString,b.Family.prototype.toHTML=j.familyHTML,b.Relationship.prototype.toString=j.relString,b.Relationship.prototype.toHTML=j.relHTML,b.Item.prototype.toString=j.itemString,b.Item.prototype.toHTML=j.itemHTML,b.Weather.prototype.toString=j.weatherString,b.Weather.prototype.toHTML=j.weatherHTML,b.Gang.prototype.toString=j.gangString,b.Gang.prototype.toHTML=j.gangHTML,b.Store.prototype.toString=j.storeString,b.Store.prototype.toHTML=j.storeHTML}(ion,ion.models,ion.Builder,ion.models.Character,ion.models.Relationship);var atomic={},fantasy={};ion.models.AtomicProfession=function(a,b){var c=["","Seaman","Petty Officer","Ensign","Lieutenant","Lieutenant Commander","Commander","Captain","Admiral"],d=["Officer",["Officer","Trooper"],"Detective","Sergeant",["Captain","Deputy Marshal"],["Inspector","Marshal"],["Deputy Chief","Undersheriff"],["Chief","Sheriff"]],e=["","Private","Corporal","Sergeant","Lieutenant","Captain","Major","Colonel","General"];return a.define(b,{init:function(a){b.call(this,a||{})},assignRank:function(b){var f=this.names[0],g=null,h=Math.round(1.5*Math.max(b.trait("Military"),b.trait("Government")));"Navy"===f||"Coast Guard"===f?g=c[a.roll(h)]:"Police"===f?(g=d[a.roll(h)],g instanceof Array&&(g=a.random(g))):g=e[a.roll(h)],b.honorific=g?f+" "+g:f}})}(ion,ion.models.Profession),window.c_locations=["Agricultural","Automotive","Civic","Criminal","Garage","Hospital","House","Industrial","Institution","Lodging","Military","Office","Public","Research","Restaurant","School","Settlement","Store","Tourism","Travel"],window.c_profs=["Air Force","Army","Bounty Hunter","Coast Guard","Courier","Craftsperson","Doctor","Homesteader","Marine","Mayor","Mechanic","Miner","Navy","Police","Raider","Rancher","Scavenger","Scientist","Settler","Thief","Trader","Tradesperson"],ion.itemDb=new ion.models.ItemDatabase(["ammo","ammo:22","ammo:30","ammo:308","ammo:357","ammo:38","ammo:44","ammo:45","ammo:fusion","ammo:laser","ammo:pulse","ammo:shell","armor","br","bundled","heavy","nobr","unique","accessories","body","coat","feet","head","con","con:35mm","con:battery","con:polaroid","food","fresh","preserved","ration","common","rare","uncommon","female","male","cash","clothing","communications","container","currency","drug","explosive","jewelry","medical","sport","tool","toy","kit:courier","kit:craftsperson","kit:doctor","kit:electrician","kit:gunslinger","kit:homesteader","kit:leader","kit:mechanic","kit:miner","kit:personal","kit:police","kit:raider","kit:rancher","kit:scavenger","kit:scientist","kit:settler","kit:soldier","kit:thief","kit:trader","kit:vagrant","agricultural","automotive","civic","criminal","garage","hospital","house","industrial","institution","lodging","military","office","public","research","restaurant","school","settlement","store","tourism","travel","hand","huge","large","medium","miniscule","small","tiny","historical","luxury","scifi","secured","useful","firearm","melee","pistol","rifle","shotgun","smg"]),ion.itemDb.register("$1 bill!.01!0!31 36 40","$1 casino chip!.2!0!33 40","$10 bill!.1!0!33 36 40","$10 casino chip!2!0!33 40","$100 bill!1!0!32 36 40","$20 bill!.2!0!33 36 40","$25 casino chip!5!0!32 40","$5 bill!.05!0!31 36 40","$5 casino chip!1!0!32 40",".22 caliber bullet!1!.5!33 0 1",".30 caliber bullet!1!.5!33 0 2",".357 caliber bullet!1!.5!33 0 4",".38 caliber bullet!1!.5!33 0 5",".44 caliber bullet!1!.5!33 0 6",".45 caliber bullet!1!.5!33 0 7","American flag!1!3!31 70 76 78 80 83 17","Boss of the Plains hat!6!.5!32 37 22 54 63 35 80","Dutch Lad snack cake!6!1!32 27 74 96 29 30","Kit-Cat klock; Tiki statue!1!3!33 74 84 85","Kooba Kid comic book; Bubbles and Yanks comic book; Volto from Mars comic book; Clutch Cargo comic book!6!.5!32 72 74 57","M1 Rifle; M1 Carbine!12!10!32 2 13 100 64 103","M14 Rifle!12!10!32 3 13 100 64 103","M1911 Pistol!9!3!32 7 13 100 54 64 102","Remington .44 Magnum Pistol; Smith & Wesson .44 Magnum Pistol; Colt .44 Magnum Pistol!9!3!32 6 13 100 48 52 54 56 58 59 61 63 66 102","Remington 870 Shotgun; Winchester 1897 Shotgun; Winchester Model 12 Shotgun!9!10!32 11 13 100 72 74 48 56 58 59 61 63 66 104","Remington Rifle!12!10!32 68 1 13 100 72 74 48 52 53 56 59 60 61 63 66 103","Ruger .22 Pistol!9!3!32 1 13 100 50 56 62 63 65 66 102","Ruger Single Six Revolver!9!3!32 1 13 100 48 56 60 61 63 66 67 102","Smith & Wesson .357 Magnum Pistol; Colt .357 Magnum Pistol!9!3!32 4 13 100 52 54 56 58 59 61 63 65 66 102","Smith & Wesson .38 Special Revolver; Colt Detective Special Revolver!9!3!32 5 13 100 48 49 50 51 54 55 56 58 61 63 65 66 102","Smith & Wesson Service Revolver; Colt Service Pistol!9!3!32 7 13 100 48 49 50 51 55 56 58 61 62 63 66 67 102","Springfield Rifle!12!10!32 2 13 100 48 52 61 64 103","Thompson Submachine Gun; M3 Submachine Gun; Browning Automatic Rifle!12!10!32 7 13 100 64 105","Twinkle Cake!3!1!33 27 74 29 30 83 86 87","Winchester Rifle!12!10!32 68 3 13 100 72 74 48 52 53 56 60 61 63 66 103","apple pie; cherry pie; peach pie!4!3!33 68 27 28 96 84","apple; pear; nectarine; orange; peach{es}; plum!4!.5!31 27 28 63 96","ashtray!1!1!31 74","axe; pickaxe!3!20!33 68 72 15 56 101 46","backpack!11!10!31 39 74 48 61 67 77 78 84 87 99","bag{s} of sugar!11!3!32 27 74 29 99","bandana; baseball cap!1!.5!31 37 34 22 74 48 49 51 53 55 56 59 60 61 63 65 67 35","baseball bat!3!3!31 72 48 53 59 61 65 67 101 45","baseball; softball; tennis ball!1!1!31 74 80 83 84 45","batter{y|ies}!3!.5!33 23 25","bayonet!3!1!31 64 101","belt{s} with large silver buckle{s}!3!.5!33 18 37 52 60 35","beret; boonie hat; garrison cap; patrol cap!1!.5!31 37 34 22 64 35 78","boater's straw hat; Panama straw hat!3!.5!33 70 37 22 74 50 53 54 62 63 66 67 77 35 80","bolo tie!1!.5!31 18 37 74 52 60 66 77 35 84","book!3!3!31 95 83","book{s} of cattle brands!1!1!31 60 17","boomerang; bubble gum cigar; frisbee; hula hoop; Hopalong Cassidy cap gun; coonskin cap; slinky!1!3!33 74 84 85 47","bottle{s} of milk!1!3!31 27 28 74 63","bottle{s} of scotch; bottle{s} of whiskey; bottle{s} of vodka; bottle{s} of wine!13!10!33 41 74 57 96","bowling ball!6!20!32 15 74 80 45","box{es} of .22 ammo (20 rounds)!30!3!32 0 1 14","box{es} of .30 ammo (20 rounds)!30!3!32 0 2 14","box{es} of .308 ammo (20 rounds)!30!3!32 0 3 14","box{es} of .357 ammo (20 rounds)!30!3!32 0 4 14","box{es} of .38 ammo (20 rounds)!30!3!32 0 5 14","box{es} of .44 ammo (20 rounds)!30!3!32 0 6 14","box{es} of .45 ammo (20 rounds)!30!3!32 0 7 14","box{es} of Sugar Jets cereal!3!3!33 27 74 29","box{es} of Velveteena cheese!6!3!33 27 73 74 96 29 82 85","box{es} of candies!9!3!32 74 96","box{es} of candles!9!3!31 72 74 56 61 99","box{es} of chocolates!6!3!32 27 74 96 29","box{es} of hardtack!9!3!33 27 78 30 99","box{es} of matches!3!.5!31 71 72 74 57 59 60 61 63 65 46 99","box{es} of shotgun shells (20 shells)!30!3!32 0 11 14","box{|es} of toaster pastries!3!3!33 27 74 29 30","bracelet!10!1!33 43 98","briefcase!1!10!31 13 70 79 80 81","bucket hat; coonskin cap!3!.5!33 37 34 22 48 53 59 61 63 66 67 35","bulletproof vest!11!10!33 12 13 71 58 61 64 99","business suit!1!3!31 19 37 74 54 63 77 35","butcher's kni{fe|ves}!3!3!31 74 63 101 82","camera!3!3!33 13 24 57","canteen; water bottle!1!3!31 57 78 85","can{s} of Brylcreem!3!1!33 74 57","can{s} of Fido dog food!3!3!31 27 74 29","can{s} of Rinso Detergent!1!3!31 74","can{s} of coffee; jar{s} of instant coffee!6!3!32 27 74 96 29","can{s} of milk; can{s} of pork & beans; box{es} of crackers; can{s} of wham!3!3!31 27 74 29","can{|s} of mace; can{|s} of pepper spray!3!1!33 49 50 51 54 55 62 63 65 101","carton{s} of cigarettes!150!3!32 41 96","casualwear outfit!1!3!31 19 37 34 74 63 77 35","cigarette lighter!3!.5!31 71 74 57 63 46 99","clipboard!1!3!31 79","coat; overcoat; parka; windbreaker!1!3!31 68 70 37 20 34 73 74 75 76 53 57 58 77 35 79 80 82 84","coffee mug!1!1!31 74 79","coffee pot!1!3!31 74","coil{s} of rope (50 feet)!3!10!33 68 72 84 46","comb; handkerchief!1!.5!31 74 57","combat helmet!1!.5!31 12 37 34 22 59 61 64 35 78","compass!6!.5!32 72","cowboy hat!1!.5!31 68 37 34 22 52 60 35","crowbar; tire iron!3!6!31 72 15 59 61 101 46","crutch{es}!3!10!33 44","dagger!3!1!31 52 59 61 63 64 65 101","day pack!11!10!31 70 39 74 75 48 49 51 55 56 59 61 63 65 67 77 78 83 84 87 99","day{s} of C rations!11!6!31 27 15 78 29 30 99","death ray!27!3!32 8 13 100 102 81 97","deck{s} of playing cards!6!1!31 71 74 57 99","denim jacket!1!.5!31 37 20 34 49 51 55 65 67 35","doctor's bag!1!10!31 18 37 39 34 73 50 35","duster; buckskin coat; poncho!3!.5!33 68 37 20 34 48 52 59 60 66 35","egg; potato{es}!1!.5!31 27 28","empty fuel can!1!10!31 69 39 72 75 48","fedora; flat cap; porkpie hat!1!.5!31 37 22 74 50 54 62 63 66 67 77 35 80 84 87","fire axe!3!10!33 69 70 71 73 75 76 49 51 55 56 61 67 101 78","fire extinguisher!1!15!31 69 70 71 15 73 75 76 77 78 79 80 81 83 87","first aid kit!13!10!33 44 99","flashlight!6!1!31 69 13 70 25 72 74 75 76 57 81 84 46 99","floral dress; jumper{s} with {a |}blouse{s}; jumper{s} with {a |}T-shirt{s}; skirt{s} and blouse{s}; prairie skirt{s} and blouse{s}; shirtwaist dress!1!.5!31 19 37 34 49 50 53 54 62 63 66 67","football; tennis racket!1!10!31 74 80 83 84 45","force field belt!15!1!32 12 13 81 97","gas mask!1!3!33 12 13 58 64 78","geiger counter!11!3!33 13 75 56 61 62 64 81 46 99","gold krugerrand!10!1!33 40 15 98","gravity rifle!36!20!32 8 13 100 15 78 81 103 97","hand grenade!3!1!33 42 59 61 64 78","hard hat{s} with lamp{s}; hard hat!3!.5!33 37 34 22 75 56 35","hockey mask!1!3!33 12 59","hoe; rake; shovel!3!10!33 68 72 63 101 46","holster!3!1!33 18 37 34 52 57 64 35 17","house deed!6!1!32 98","hunting kni{fe|ves}!3!1!31 52 53 54 60 61 63 66 67 101","ice pick!3!20!33 72 15 101 46","jar{s} of Ersatz instant coffee!6!3!32 70 27 74 96 79 29 30 87","jar{s} of Gusto pasta sauce; box{es} of Gusto spaghetti; jar{s} of Gusto olives; box{es} of Gusto bread sticks; can{s} of Gusto ravioli!3!3!31 27 74 29 82 85","jar{s} of jam!1!1!31 27 28 74 82","jug{s} of moonshine!10!10!33 68 41 57","jumpsuit; {|}work coveralls!1!3!31 68 69 19 37 34 75 76 49 51 55 56 61 35","knife; fork; spoon!1!1!31 74 82","lab coat!1!3!31 37 20 34 73 76 50 62 35 81","lariat!1!3!31 60 17","laser pistol!27!3!32 9 13 100 62 64 102 81 97","laser rifle!36!10!32 9 13 100 64 81 103 97","letter sweater!3!.5!33 37 20 34 63 35","loa{f|ves} of bread!1!3!31 27 28 63","lockpick set!11!1!32 71 65 46 99","lunchbox{es}!3!10!33 74","magazine!3!3!31 95 87","medical brace!3!10!33 44","metal detector!6!10!32 13 72 61 78 84 46 17","military helmet!9!3!33 12 61 64 99","motorcycle helmet; football helmet!9!3!33 12 72 59 61 99","motorcycle jacket!11!3!33 37 20 34 72 48 52 59 61 35 99","mouse trap!3!1!33 72 74 46","necklace!12!1!33 43 98","newspaper!3!3!31 69 70 71 72 95 73 74 75 76 77 78 79 80 82 85 86 87","notebook; journal; sketchbook!6!3!32 69 70 73 74 76 57 78 79 81 83 84 86 17","pack{s} of chemical light sticks (5 sticks)!8!1!33 72 48 51 55 56 58 61 67 84 46 99","pack{s} of chewing gum; pack{s} of Blackjack chewing gum!6!.5!32 27 57 96 29 30 86 87","pack{s} of cigarettes!13!1!33 41 57 96","pair{s} of safety goggles!6!1!32 37 34 22 75 62 35 81","peaked cap; campaign hat!1!.5!31 70 37 34 22 58 35","pencil; pen!1!1!31 79 83","pipe; chain!3!3!33 72 75 59 101","pitchfork!3!10!33 68 46","plastic cup; glass!1!3!31 13 74 82 83 84","plate!1!3!31 74 82","polaroid camera!3!3!33 13 70 26 74 76 57 77 80 81 84 86 87","police baton; nightstick!3!3!33 58 101","police uniform!1!3!31 19 70 37 34 58 35","pool table!24!80!32 15 74 99","portable stove!3!3!33 13 72 48 61 66 67 45","portable water purification filter!14!3!32 13 84 46 99","pressure cooker; hot plate!6!10!32 13 74","pulse pistol!27!6!32 10 13 100 15 62 64 102 81 97","pulse rifle!36!20!32 10 13 100 15 64 81 103 97","purse; handbag!1!3!31 70 39 74 77 79 80 85 87","rabbit's {foot|feet}; {|pairs of }Starlight Casino dice; deck{s} of Elvis Presley playing cards; poker chip{s} from the Sands Casino in Reno; Gideon's bible; pocket crucifix; St. Jude pendant; St. Christopher figurine; Star of David necklace; {|pairs of }Masonic cufflinks; Order of Odd Fellows tie clip; class ring!3!.5!33 57 17","radiation suit!13!10!33 13 37 20 34 75 56 61 64 35 81 99","red Gingham dress; blue Gingham dress; yellow Gingham dress; green Gingham dress; black and white Gingham dress!1!.5!31 19 37 34 49 50 53 54 62 63 66 67","rifle scope!8!1!33 68 13 74 60 63 99","ring!7!.5!33 43 98","road map!1!1!31 69 72 48 52 61 66 67 77 87","roll{s} of 35mm film (24 shots)!6!.5!32 23 24","roll{s} of polaroid film (10 shots)!3!1!33 23 26","safe-cracking kit!20!20!32 13 70 71 61 65 46 99","scalpel!1!1!31 44 46","set{s} of horse tack!1!20!31 68","set{|s} of keys!1!.5!31 69 70 74 75 76 77 78 79 81 83 85 17","shawl!3!.5!33 68 37 20 34 74 50 53 54 63 66 67","shiv; switchblade!3!1!31 71 59 61 65 101","shotgun shell!1!.5!33 0 11","slab{s} of bacon!1!1!31 27 28 74","sleeping bag; tent!1!10!31 72 48 61 67","sombrero!6!.5!32 68 37 22 52 60 67 35","stick{s} of beef jerky!3!1!31 27 74 29 30","stick{s} of dynamite!3!1!33 42 75 56","straw sun hat!3!.5!33 70 37 34 22 74 50 53 54 62 63 66 67 77 80","stun baton!11!3!32 58 64 101 99","suit{|s} of riot gear!15!20!33 12 13 70 71 58 61 78 99","sword; machete!3!3!32 48 63 64 101","tabletop radio!1!10!31 69 13 70 38 72 74 76 78 84","teargas grenade!3!1!33 70 42 58","thermos!11!3!33 72 74 60 61 99","toaster!1!10!31 13 74","toy robot!6!3!32 13 25 74 47","trenchcoat; sports jacket!3!.5!33 37 20 54 35","walkie-talkie!6!3!32 13 70 38 75 76 54 58 61 64 78 81","wanted poster!3!.5!33 48 52 58","will; contract; war bond; passport!1!1!31 98","wrench{es}; hammer!1!3!31 69 72 75 49 55 61 84 46","{|pairs of }Mary Jane shoes!1!.5!31 70 37 21 34 74 76 49 50 54 62 63 65 66 67 78","{|pairs of }black leather shoes!1!.5!31 70 37 21 34 74 76 48 49 50 51 54 55 58 62 63 64 65 66 67 35 78","{|pairs of }blue suede loafers; {|pairs of }saddle shoes!3!.5!33 37 21 34 63 35","{|pairs of }chaps!1!.5!31 18 68 37 34 60 35","{|pairs of }combat boots!1!.5!31 12 37 21 34 48 52 58 59 61 64 67 35 78","{|pairs of }cowboy boots!1!.5!31 37 21 34 74 48 52 53 54 55 56 59 60 61 63 65 66 67 77 35 84","{|pairs of }dice!3!.5!31 71 74 57 17 99","{|pairs of }dog tags!1!.5!31 64 78 17","{|pairs of }forceps!3!3!33 44 46","{|pairs of }military fatigues!1!3!31 19 37 34 61 64 35 78","{|pairs of }night vision goggles!14!3!32 18 13 37 25 34 58 61 64 35 78 99","{|pairs of }slacks {and a|with} button up shirt{s}!1!.5!31 19 37 74 49 50 62 63 66 67 35","{|pairs of }work boots!1!.5!31 12 37 21 34 48 52 53 56 58 59 61 63 65 67 35 78","{|sets of }football pads!11!10!33 12 72 59 61 99","{|suits of }makeshift metal armor!15!20!32 12 13 71 59 61 99","{|}binoculars!11!3!33 13 74 48 61 64 99","{|}bongos; flute!3!3!33 67 17","{|}brass knuckles!3!1!32 71 59 101","{|}jeans and a T-shirt; {|}jeans and a button up work shirt; {|}jeans and a flannel shirt; {|}jeans and a western shirt!1!.5!31 19 37 34 74 48 49 51 52 53 55 59 60 61 63 65 66 67 35"),ion.profDb=new ion.models.ProfessionDatabase(["post","pre","glasses","injuries","military:tattoo","sailor:tattoo","tattoo","Agile","Attractive","Cunning","Persuasive","Smart","Strong","Tough","Willpower","high","low","normal","Art","Athletics","Bargain","Business","Camouflage","Electrical Repair","Foraging","Forensics","Government","Homesteading","Horseback Riding","Humanities","Law","Maritime","Mathematics","Mechanical Repair","Medicine","Mining","Negotiate","Observation","Research","Scavenging","Spelunking","Tracking","Wayfinding","Archery","Explosives","Firearms","Melee Weapons","Military","Unarmed Combat","Blacksmith","Brewer","Cook","Glassblower","Leatherworker","Potter","Weaver","Woodworker","Chemical Engineering","Civil Engineering","Eletrical Engineering","Mechanical Engineering","Mining Engineering","Nuclear Engineering","Chinese","French","German","Italian","Russian","Spanish","Biology","Chemistry","Geology","Physics","Science","Social Science","Deceive","Forgery","Intimidate","Lockpicking","Pickpocket","Safe Cracking","Stealth","Streetwise","Communications","Computers","Cryptography","Programming","Robotics","Rocketry","Butcher","Carpenter","Clothier","Gunsmith","Machinist","Mason","Plumber","Wagonwright","Driving","Motorcycling","Pilot Aircraft","Trucking","common","rare","uncommon","kit:courier","kit:craftsperson","kit:doctor","kit:electrician","kit:gunslinger","kit:homesteader","kit:leader","kit:mechanic","kit:miner","kit:police","kit:raider","kit:rancher","kit:scavenger","kit:scientist","kit:settler","kit:soldier","kit:thief","kit:trader","kit:vagrant","innate"]),ion.profDb.register(ion.models.AtomicProfession,"Air Force!45 47 99!36 46 48!101 119 4 17 0 1","this.assignRank(c);","Army!45 47!36 46 48 22!101 119 4 17 0 1","this.assignRank(c);","Bounty Hunter!45 77!20 22 28 41 42 46 48 81 82 98!103 3 108 16 0","","Business Executive; Manager!20 21!26 30 32 36 63 64 65 66 67 68!103 17 1","","Carnie!20 75!37 39 82 97!103 16 1 6","","Clerk; Sales Clerk; Secretary; Salesman; Hotel Clerk; Motel Clerk; Warehouse Clerk!21!20!101 16 1","","Coast Guard!31 45 47!36 46 48!102 119 4 17 0 1 5","this.assignRank(c);","Courier!28 42!43 45 97 98 99 100!103 104 17 0","","Craftsperson!20!18 21 49 50 51 52 53 54 55 56!101 105 17 0","","Doctor!34!38 69 70 73 25!102 15 106 0 1","c.honorific = 'Doctor';","Elementary school teacher; Middle school teacher; high school teacher!38!18 19 29 32 69 70 71 72 73 74!101 2 17 1","","Engineer!32 38!84 87 88 57 58 59 60 61 62!103 17 1","","Homesteader; Farmer!27!19 20 23 33 37 49 50 51 52 53 54 55 56 97 100!101 109 17 0","","Innate!!7 8 9 10 11 12 13 14!101 123","","Librarian; Archivist!38!63 64 65 66 67 68 84!103 2 17 1","","Marine!45 47!36 46 48 42 22!101 119 4 17 0 1 5","this.assignRank(c);","Mayor; Council Member!20 26!21 37!102 15 110 0","","Mechanic!23 33!20 83 84 85 86 87 88!101 111 17 0 1","","Miner!35!23 33 40 44!101 112 16 0 1","","Navy!31 45 47 99!36 46 48!103 119 17 0 1 5","this.assignRank(c);","Newspaper Reporter!37 38!26 75 82 83!103 2 17 1","","Police!45!19 26 36 37 48 77 82!103 113 17 0 1","this.assignRank(c);","Professor!38!18 29 30 32 34 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 83 84 85 86 87 88!102 2 15 117 1","c.degree = 'Ph.D.'","Raider!45 46!22 28 41 43 44 48 75 77 81 98!103 3 114 16 0 6","","Rancher; Cowhand!28 45!19 20 24 27 37 41 42!101 115 17 0 1","","Scavenger!39 42!24 37 78 80 43 46 45!101 3 116 17 0","","Scientist!38!32 69 70 71 72 73 74 83 84 85 86 87 88!102 2 15 117 0 1","","Settler!27!19 20 23 33 37 49 50 51 52 53 54 55 56 97 100 82!101 118 17 0","","Thief!75 77 82!9 78 76 79 80 81 46 85 20!101 120 16 0 1","","Trader!10 20 21!9 23 30 33 36 39 68 75 76 82 83!103 2 121 17 0","","Tradesperson!20!21 89 90 91 92 93 94 95 96!101 105 17 0",""),ion.encDb=new ion.models.EncounterDatabase(["common","uncommon","rare","extractive"]),ion.encDb.register(),function(a,b,c,d,e){function f(a,b){for(var d=b.totalValue;d>0;){b.conditions.maxValue=Math.max(Math.min(b.conditions.maxValue,d),b.conditions.minValue);var e=c.find(b);if(null===e||e.value>d)return a;a.add(e),d-=e.value}return a}function g(a,b){if(b>0)for(var d=c.findAll("currency",{maxValue:b});b>0;){var e=d.get();if(null===e)return;a.add(e),b-=e.value}}function h(a,d){var e=b.test(60)?"firearm":"melee",f=c.find(e,d,"-br");if(f&&(a.add(f),f.is("firearm"))){var g=c.find("ammo",f.typeOf("ammo"),"-bundled");g&&a.add(g,b.roll("4d4")),b.test(20)&&(f=c.find("melee",d,"-scifi"),f&&a.add(f))}}function i(a,d,e){for(var f=0;d>f;f++){var g=c.find(b.select(e));g&&a.add(g)}return a}function j(a,b,d){for(var f=new e,g=0;b>g;g++){var h=c.find(d);h&&f.add(h)}return k(a,f)}function k(a,b){return b.toArray().forEach(function(b){a.add(b)}),a}function l(a,c,d){return function(e,f,g){b.test(e)&&j(a,f,b.format(g,c,d))}}a.createKit=function(a){console.assert(!!a,"params required"),console.assert(!!a.profession,"profession required");var c=new d,e=b.isString(a.profession)?"kit:"+a.profession:a.profession.typeOf("kit");h(c,e);var f=l(c,a.gender,e);return f(100,1,"body {0} {1}"),f(30,1,"head {0} {1}"),f(50,1,"coat {0} {1}"),f(30,1,"accessories {0} {1} -br"),f(100,1,"feet {0} {1}"),f(100,b.roll("1d3-1"),"{1} -clothing -firearm -melee -br | kit:personal -br"),i(c,b.roll("2d3-2"),["ration","ration","food -fresh"]),c.value()<20&&g(c,b.roll(20-c.value())),c},a.createBag=function(a){a=a||{};var e=c.parseQuery.apply(c,b.values(a)),h=f(new d,e);return e.fillBag!==!1&&g(h,e.totalValue-h.value()),h};var m={Safe:{desc:["Safecracking+1","Safecracking","Safecracking-1","Safecracking-2","Safecracking-3","Safecracking-4"],query:{totalValue:"3d8+15",tags:"cash | firearm -scifi | secured | luxury -food",conditions:{maxEnc:10},fillBag:!1}},Lockbox:{desc:["Unlocked","Lockpicking","Lockpicking-1","Lockpicking-2"],query:{totalValue:"2d6+2",tags:"cash | secured | firearm -scifi -br | asetofkeys | luxury -food",conditions:{maxEnc:3},fillBag:!0}},Trunk:{desc:["Unlocked","Lockpicking+2, can be broken open","Lockpicking+3, can be broken open","Lockpicking+4, can be broken open"],query:{totalValue:"2d6",tags:"clothing | armor | firearm -scifi -br | unique",conditions:{maxEnc:10},fillBag:!1}},"Cash Register":{desc:["easily opened"],query:{totalValue:"6d50/100",tags:"cash",fillBag:!0}},"Currency on hand":{desc:["under the counter","in a lockbox"],query:{totalValue:"2d3",tags:"currency",fillBag:!1}},"Clothes Closet":{desc:["no lock"],query:{totalValue:"1d8+5",tags:"clothing -research -industrial -military",fillBag:!1}}},n=Object.keys(m).sort();a.createContainer=function(c){if(!m[c])throw new Error("Invalid container, use: "+n.join(", "));var d=m[c],e=b.extend({},d.query);e.totalValue=b.roll(e.totalValue);var f=a.createBag(e);return d.desc&&(f.descriptor=b.format("{0} ({1})",b.titleCase(c),b.select(d.desc))),f},a.getContainerTypes=function(){return n}}(atomic,ion,ion.itemDb,ion.models.Bag,ion.models.IonSet),function(a,b){function c(a,c){return b.random(e[b.format("hispanic"===c&&b.test(35)?"anglo {0}":"{1} {0}",a,c)])}function d(a){return b.random(e[a])}var e={"anglo male":["Al","Andy","Arnie","Art","Austin","Bart","Beau","Ben","Bert","Bob","Brad","Bradley","Brock","Bruce","Bud","Burt","Caleb","Calvin","Carl","Cecil","Chuck","Clayton","Cliff","Conrad","Cooper","Cyril","Dakota","Dallas","Dalton","Dan","Dawson","Dean","Destry","Don","Doug","Dwain","Earl","Ed","Errol","Floyd","Frank","Fred","Gage","Garth","Gavin","Gene","Glen","Grady","Greg","Gus","Guy","Hal","Hank","Harlan","Holden","Hoyt","Hudson","Hugh","Huxley","Ian","Isaac","Jack","Jake","Jason","Jeremy","Jerry","Jethro","Joe","John","Johnny","Ken","Kirk","Kurt","Kyle","Larson","Levi","Lloyd","Luke","Lyle","Mack","Mark","Marty","Mason","Matt","Max","Merle","Nate","Ned","Neil","Nick","Norm","Otis","Pat","Phil","Ray","Reed","Rex","Rick","Rod","Rodger","Roy","Russell","Sam","Scott","Slim","Stan","Stratton","Ted","Tim","Todd","Tony","Travis","Tyler","Vern","Wade","Wally","Ward","Wesley","Will","Wyatt"],"anglo female":["Ada","Agnes","Alice","Amy","Ann","Audrey","Barb","Becky","Betty","Bev","Carol","Cindy","Clara","Darla","Diane","Dona","Doris","Edith","Edna","Eileen","Ella","Ellen","Emma","Emily","Erma","Esther","Ethel","Eva","Fay","Flo","Flora","Gail","Grace","Gwen","Hazel","Helen","Holly","Ida","Ilene","Irene","Iris","Irma","Jan","Jane","Janet","Janis","Jean","Joan","Judy","June","Kathy","Kay","Lena","Linda","Lois","Lorna","Lucy","Mabel","Mae","Mary","Mavis","Nina","Nora","Norma","Olga","Pam","Patty","Paula","Pearl","Rita","Rose","Ruth","Sally","Sara","Stella","Sue","Sybil","Tina","Trudy","Velma","Vera","Viola","Wanda","Wilma"],"hispanic male":["Alonso","Bruno","Camilo","Carlos","Dante","Diego","Emilio","Felipe","Franco","Iker","Jacobo","Javier","Jorge","Jose","Juan","Julian","Lucas","Luis","Manny","Manuel","Mario","Mateo","Matias","Miguel","Pablo","Pedro","Rafael","Samuel","Sergio","Tomas","Elias"],"hispanic female":["Abril","Alexa","Alma","Ana","Ariana","Ashley","Bianca","Camila","Carla","Elena","Emilia","Isabel","Jimena","Julia","Luana","Lucia","Maite","Malena","Maria","Mia","Regina","Renata","Sofia","Sophie","Valery"],anglo:["Adams","Alexander","Anderson","Bailey","Baker","Barnes","Bell","Bennett","Brooks","Brown","Bryant","Butler","Campbell","Carter","Clark","Cleaver","Coleman","Collins","Cook","Cooper","Cox","Davis","Edwards","Evans","Flores","Foster","Gray","Green","Griffin","Hall","Harris","Haskell","Henderson","Hill","Howard","Hughes","Jackson","James","Jenkins","Johnson","Jones","Kelly","King","Lewis","Long","Martin","Miller","Mitchell","Moore","Morgan","Morris","Murphy","Nelson","Parker","Patterson","Perry","Peterson","Phillips","Powell","Price","Reed","Richardson","Roberts","Robinson","Rogers","Ross","Russell","Sanders","Scott","Simmons","Smith","Stewart","Taylor","Thomas","Thompson","Turner","Walker","Ward","Washington","Watson","White","Williams","Wilson","Wood","Wright","Hayes"],hispanic:["Aguilar","Aguirre","Alvarado","Alvarez","Avila","Barrera","Cabrera","Calaveras","Calderon","Camacho","Campos","Cardenas","Carrillo","Castaneda","Castillo","Castro","Cervantes","Chavez","Contreras","Cortez","Delacruz","Deleon","Diaz","Dominguez","Escobar","Espinoza","Estrada","Fernandez","Flores","Fuentes","Gallegos","Garcia","Garza","Gomez","Gonzales","Guerra","Guerrero","Gutierrez","Guzman","Hernandez","Herrera","Ibarra","Jimenez","Juarez","Lopez","Lozano","Macias","Marquez","Martinez","Medina","Mejia","Melendez","Mendez","Mendoza","Mercado","Miranda","Molina","Montoya","Morales","Moreno","Navarro","Ochoa","Orozco","Ortega","Ortiz","Pacheco","Padilla","Perez","Ramirez","Ramos","Reyes","Rivera","Rodriguez","Romero","Rosales","Ruiz","Salas","Salazar","Salinas","Sanchez","Sandoval","Santiago","Serrano","Silva","Suarez","Torres","Trevino","Trujillo","Valdez","Valencia","Vargas","Vasquez","Velasquez","Velez","Villarreal","Zamora"]};a.createCharacterName=function(a){a=a||{};var e=a.gender||(b.test(50)?"male":"female"),f=a.race||(b.test(20)?"hispanic":"anglo");return new b.models.Name({given:a.given||c(e,f),family:a.family||d(f)})}}(atomic,ion),function(a,b,c,d){function e(a,c){return b.random(b.format(b.random(a),c))}function f(a,c){var d=s.get(),e=null;"hispanic"===a.race&&"blond"===d&&(d=b.random(["brown","black"])),a.age>40&&b.test(a.age)&&(d=b.random(["gray","silver","white"])),e=a.is("low")&&a.male&&a.age<30&&b.test(25)?"{0} mohawk":a.male?t.get():u.get(),c.push(b.random(b.format(e,d)))}function g(a,b){var c=r.get();c&&b.push(c)}function h(c,d){var f=c.has("glasses")?70:10;b.test(f)&&(b.test(20)?d.push(c.male?"wears browline glasses":"wears cat eye glasses"):d.push(b.test(30)?"wears horn-rimmed glasses":"wears glasses"));var g=c.has("tattoos")||c.has("military:tattoos")||c.has("sailor:tattoos")?30:5;if(g+=c.male?15:0,b.test(g)){var h=null,i=a.createCharacterName({gender:c.male?"female":"male"}).given;h=c.has("military:tattoo")&&b.test(80)?k:c.has("sailor:tattoo")&&b.test(80)?j:c.male&&b.test(20)?m:!c.male&&b.test(20)?n:l,h=e(h,{name:i});var q=b.format("has a tattoo of {0} on {1} {2} {3}",h,c.possessive,b.random(["left","right"]),b.random(["shoulder","bicep","forearm","arm"]));d.push(q)}var r=c.has("injuries")?15:3;b.test(r)&&d.push(e(o,c));var s=c.has("prosthetics")?5:1;b.test(s)&&d.push(e(p,c))}function i(a,c){b.test(30)&&c.push(e(q,a))}var j=['a sailing ship with the words "Homeward Bound" below it',"an anchor"],k=["an American {flag|eagle}","an eagle carrying an American flag"],l=["a skull{| in flames| with wings| and crossbones}","a chinese dragon","a {black panther|tiger|lion|wolf}","a mermaid","a snake wrapped around a {cross|rose}","a pair of dice",'a four leaf clover with the word "lucky" across it','a heart with the name "{name}" across it','the name "{name}"',"{a crystal|an eight} ball","a {star|cross|phoenix|lion|tiger|crown|fish|scorpion|lucky clover|yin-yang symbol}","an {angel|anchor|ankh}","a heart and dagger"],m=["a{ | blonde| brunette| redhead} pin-up {girl|cowgirl}","a pin-up girl {in a sailor's suit|in a WAC uniform|in a space suit}","a woman on a clamshell"],n=["a {butterfly|swallow|dragonfly|rose|fairy|heart|lotus flower}","two intertwined roses"],o=["missing a tooth","missing {possessive} {left|right} {ear|foot|hand}","has been burnt on {possessive} {left|right} arm","walks with a limp","wears an eyepatch","cast on {left|right} arm","scar on {possessive} {left|right} arm","scar on {left|right} side of {possessive} {leg|torso|face}"],p=["hook for a {right|left} hand","artificial {hand|leg|arm}","glass eye"],q=["will {be very loyal to|betray or abandon} the players in a crisis","will trade generously with players","will demand compensation for minor tasks","if angered, will drag the player group into unnecessary fights","will fight to the death if necessary","if left alone, will {drink|gamble} away any money {personal} has","will expect {an equal share in profits|payment} to join the group","smokes (values acquiring tobacco)","values fine wines and liquors","chews gum (values acquiring chewing gum)"],r=(new c).add(10,"tall stature").add(10,"short stature").add(5,"short and heavy-set").add(5,"tall and heavy-set").add(70,null),s=(new c).add(15,"black").add(50,"brown").add(15,"blond").add(3,"red").add(10,"auburn (brownish-red)").add(7,"chestnut (reddish-brown)"),t=(new c).add(30,"{0} crew cut haircut").add(25,"{0} side part haircut").add(25,"{0} ivy league haircut").add(20,"{0} pompadour haircut"),u=(new d).add("common","bobbed {0} hair").add("common","short {curly|straight} {0} hair").add("uncommon","long {curly|wavy|straight} {0} hair, usually worn {in a ponytail|under a scarf|in a bun}").add("uncommon","{0} pageboy haircut").add("rare","long {curly|wavy|straight} {0} hair").add("rare","cropped {0} hair");a.createAppearance=function(a){var c=[],d=[];return f.call(this,a,c),g.call(this,a,c),h.call(this,a,c),i.call(this,a,d),[c,d].reduce(function(a,c){return c.length&&a.push(b.sentenceCase(c.join(", "))),a},[]).join(". ")}}(atomic,ion,ion.tables.Table,ion.tables.RarityTable),function(a,b,c,d,e,f){function g(c,e,f){if(b.isString(c)){var g=c.split(" ");return new d({given:g[0],family:g[1]})}if(c instanceof b.models.Name){var h=a.createCharacterName({gender:e,race:f});return b.extend(h,c)}return a.createCharacterName({gender:e,race:f})}function h(c){var d=b.extend({},c);return d.gender=d.gender||b.random(["male","female"]),d.equip=b.isBoolean(d.equip)?d.equip:!0,d.race=d.race||a.createRace(),d.name=g(d.name,d.gender,d.race),d.age=b.isNumber(d.age)?b.bounded(d.age,1,100):b.roll("14+3d12"),d.traits&&(d.traits=b.extend({},d.traits)),d.profession&&(d.profession=b.toTag(d.profession)),"soldier"===d.profession&&(d.profession=b.random(["airforce","marine","army","navy"])),d
}function i(a){a.age>4&&(k.train(a,b.roll("1d3-1")),delete a.traits.Attractive)}function j(d,e,f){var g=b.sum(b.values(f.traits)),h=8+~~(f.age/10)-g;k.train(d,b.roll("2d2-1"));var i=c.find("pre -innate"),j=b.intersection(i.tags,["low","normal","high"]),m=e?e:c.find(j+" post -pre -innate"),n=i.is("high")?30:27;if(m.not("pre")&&d.age>n){var o=(d.age-10)/d.age,p=Math.floor(h*o),q=h-p;if(i.train(d,p),i.names[0]!==m.names[0]){var r=d.honorific?d.honorific:b.select(i.names),s=b.select(l);d.history.push(b.format(s,b.article(r.toLowerCase())))}delete d.honorific,m.train(d,q)}else m.train(d,h);d.profession=b.select(m.names),f.equip&&(d.inventory=a.createKit({profession:m,gender:d.gender}))}var k=c.find("innate"),l=["Before the collapse, was {0}","Was {0} up until the war","Was {0} before the war"];a.createCharacter=function(d){var e=null,g=h(d);if(g.profession&&(e=c.find(g.profession),null===e||e.not("post")))throw new Error("Invalid profession: "+g.profession+" (must be post-war profession)");var k=new f(g);return k.age<17?i(k,g):(j(k,e,g),k.appearance=a.createAppearance(k),k.initiative=b.roll("2d6")+k.trait("Agile"),k.hp=10+k.trait("Tough")),"hispanic"===k.race&&k.changeTrait("Spanish",b.nonNegativeGaussian(1.5)),k},a.createRace=function(){return b.test(20)?"hispanic":"anglo"}}(atomic,ion,ion.profDb,ion.models.Name,ion.tables.Table,ion.models.Character,ion.models.IonSet),function(a,b,c,d){function e(a,d){var e=c.find(a);d.members.forEach(function(a){a.traits.Military=.5,e.assignRank(a),a.traits.Military=1});var f=b.last(d.members),g=d.members[0].honorific;f.traits.Military=4;do e.assignRank(f);while(f.honorific===g)}function f(a){return a.is("food")||a.is("kit:personal")}function g(a){return i[b.test(80)?"both":a.male?"male":"female"]}var h={"Biker Gang":{prof:"raider",nicks:100,traits:{Motorcycling:1},count:"3d4-2",mil:!1,names:["Pagans","Outlaws","Bandidos","Mongols","Vagos Motorcycle Club","Free Souls","{Grim |}Reapers","Gypsy Jokers","Highwaymen","Iron Horsemen","Rebels","Comanchero","Devil's Disciples","Diablos","Finks","58s","Road Devils","{Lone |}Legion","Road {Devils|Knights}","Skeleton Crew","Low Riders"]},"Street Gang":{prof:"thief",nicks:100,count:"1d4+1",mil:!1,names:["Magnificents","Purple Hearts","Coasters","Businessmen","Gladiators","{Earls|Dukes|Counts|Barons|Lords}","Daggers","Big Dogs","Young Lords","Imperial Hoods","Bulls","Lightenings","Crowns","Senators","Hawks","Savages","Lucky Seven","Gents","Enchanters"]},"Raiding Gang":{prof:"raider",count:"3d4-2",nicks:90},"Scavenger Party":{prof:"scavenger",count:"1d4+1",nicks:50},"Cowboy Posse":{prof:"rancher",count:"1d5+1",nicks:20},"Cattle Rustler Gang":{prof:["rancher","rancher","scavenger","thief"],count:"1d3+1",nicks:50},"Army Patrol":{prof:"army",count:"1d3*4",mil:"army",nicks:5},"Marine Patrol":{prof:"marine",count:"1d3*4",mil:"marine",nicks:15}},i={female:['{given} "The {Queen|Vixen|Waitress|Witch}" {family}','"{Ma|Baby Blue Eyes|Fat Girl|Gold Digger|Hot Lips|Monkey Girl|Repo Girl|Roxy|Sweet Cakes|Wild Woman}" ({given} {family})'],male:['{given} "{Wild|Repo|Hatchet|Ice} Man" {family}','"{Bugsy|Pa|Bag Man|Monkey Boy|Muscles|Caveman|Maverick|Music Man|Nice Guy|Pretty Boy}" ({given} {family})','{given} "The {Hitman|Sandman|Watchman|Rifleman|Gunman|Trigger Man}" {family}','{given} "{Lil|Fat|Big} {Loco|Man|Boy|Daddy|Tuna} {family}"'],both:['"{Big|Fat|Little|Skinny|Greedy|Crazy|Trigger|Two-Finger|Three-Finger|Young|Old|Doc|Lowdown|Rowdy} {given}" {family}','{given} "The {Agitator|Ant|Bag|Banker|Barber|Blast|Bloodhound|Boot|Brain|Brains|Bug|Bull|Burnout|Bystander|Cartridge|Cheater|Clown|Cruiser|Dasher|Dentist|Duke|Fence|Ghost|Reaper|Groundhog|Hammer|Hatchet|Joker|Kid|Killer|Knife|Lead Foot|Machine|Menace|Monster|Mouse|Rat|Prairie Dog|Mouthpiece|Mumbler|Ox|Rabbit|Razor|Rev|Roach|Saint|Show|Shotgun|Snake|Sore|Suit|Trigger|Unwanted|Viper|Waiter|Wall|Watcher|Weasel|Whisperer|Wire|Wolf|Zealot|Zero|Zookeeper|Plumber|Kleaner}" {family}','"{Ammo|Angel|Animal|Baby Face|Babycakes|Baldo|Bananas|Band-Aid|Bats|Beans|Beef|Bench|Bix|Black Eye|Blackjack|Blaze|Bloody|Blue Eyes|Blue Nose|Books|Boxcars|Bugs|Bugsy|Butterfingers|Candles|Coins|Cold Finger|Crackers|Cranky|Creaky|Cue Ball|Cuts|Dasher|Devious|Dice|Digger|Droopy|Eyes|Fangs|Fast Trigger|Flames|Flowers|Foot Long|Framed|Freckles|Free Style|Frosty|Goldie|Greasy Thumb|Great White|Ha-Ha|Half Full|Happy|Hell Raiser|Holy Smoke|Hot Shot|Icepick|Itchy|Jezebel|Kid Blast|Kid Twist|King Kool|Knots|Knuckles|Ladykiller|Lefty|Long Hair|Looney|Lucky|Machine Gun|Maniac|Matches|Midnight|Moneybags|Needles|Nitro|Numbers|Old Creepy|One Arm|Patch-Eye|Payola|Peanuts|Pee Wee|Pinky|Popcorn|Pork \'n Beans|Roadkill|Roulette|Scarface|Scars|Scumbag|Seven Clip|Shades|Shady Eyes|Shaggy|Sharp Edge|Sharpie|Shiny|Shocker|Short Stack|Side Step|Silver Dollar|Skidmarks|Slingshot|Sluggo|Smiley|Smokey|Sneakers|Spanky|Sparkey|Spinner|Squeaky|Squinty|Sticks|Sticky Fingers|Stonewall|Tick Tock|Toothless|Trails|Twinkle Cakes|Two Guns|Two Holes|Wheels|Wild Child}" ({given} {family})']},j=b.keys(h);a.getGangTypes=function(){return j.sort()},a.assignNickname=function(a){var c=g(a);return a.name.nickname=b.format(b.random(b.random(c)),a.name),a.name.nickame},a.createGang=function(c){c=c||{};var i=c.type||b.random(j),k=h[i];if(b.isUndefined(k))throw new Error("Invalid gang type: "+i);var l=b.isNumber(c.count)?c.count:b.roll(k.count),m={kind:i};k.names&&(m.name=b.random(b.random(k.names)));var n=new d(m);return b.times(l,function(){var c=a.createCharacter({profession:b.select(k.prof),traits:k.traits||{}});if(c.initiative=b.roll("2d6")+c.trait("Agile"),c.hp=10+c.trait("Tough"),b.test(k.nicks)){var d=g(c);c.name.nickname=b.format(b.random(b.random(d)),c.name)}c.inventory.filter(f),n.add(c)}),k.mil&&n.members.length&&e(k.mil,n),n.members.sort(function(a,b){return a.initiative<b.initiative?1:a.initiative>b.initiative?-1:0}),n}}(atomic,ion,ion.profDb,ion.models.Gang),function(a){a.createLocation=function(){throw new Error("Not implemented")},a.getRootLocations=function(){throw new Error("Not implemented")}}(atomic,ion),function(a){a.createEncounter=function(){return a.createGang()},a.getCombatTraits=function(){return["Agile","Archery","Athletics","Cunning","Driving","Explosives","Firearms","Horseback Riding","Intimidate","Medicine","Melee Weapons","Military","Motorcycling","Stealth","Strong","Tough","Tracking","Trucking","Unarmed Combat"]}}(atomic,ion),function(a,b,c){function d(a){return b.select("River"===a&&b.test(100)?j:i)}function e(){var c=a.createCharacterName();return b.test(10)?c.given:c.family}var f={Depression:["Alley","Arroyo","Canyon","Creek","Gap","Gulch","Gully","Hollow","Valley"],Flat:["Flat{|s}","Prairie","Meadow{|s}","Field","Range","Plain"],Elevation:["Bluffs","Cliff","Mountain","Point","Pass","Spur","Ridge","Butte","Mesa","Gap","Rock","Hill{|s}","Summit"],Water:["Spring{|s}","Lake","Pond","Bar","Basin","Creek","River","Reservoir","Rapids","Stream","Wetlands","Falls","Dam"],Junction:["Bend","Junction","Crossing"]},g=["Adobe","Antelope","Ash","Badger","Bald","Battle","Bear","Beaver","Big","Biscuit","Black","Blue","Buck","{|Big }Oak","Big Horn","Bison","Black","Bobcat","Bottom Dollar","Boulder","Brown","Brush","Buffalo","Bull","Buzzard's","Calamity","Cedar","Chief","Cinder","Clay","Copper","Cornstalk","Cotton{|wood}","Cougar","Coyote","Crescent","Crooked","Crow","Deadwood","Deer","{Bad|Black|Dead|Mad} Dog","Dream","Dry","Eagle","Elk","Eureka","Fox","Frog","Gold","Gold Dust","Goose","Gopher","Granite","Green","Grinders","Grouse","Gypsum","Hawk","{Dead|Lame|Happy} Horse","Horseshoe","Indian","Iron","Juniper","Last Chance","Limestone","Little Sheep","Long","Lost","{Dead|Blind} Man's","Mule","{Big |Little |}Pine{| Flat}","Prairie Dog","Rattlesnake","Red","{Big|Black|Broken|Red} Rock","Rocky","Round","Sage","Sawmill","Shady","Sheep","Silver","Skeleton","Slaughter","Stone","Tungsten","Willow","Wolf","Young"],h=["Alfalfa","Arrowhead","Arrowtail","Big Curve","{Big|Little} Elk","Buckeye","Buzzard's Roost","Casa Diablo","Deadwood","Faraday","Harmony","Hidden Valley","Indian Meadows","Irondale","Leadville","Palo Verde","Pea Vine","Point Blank","Red-Eye","Sunshine","Tanglefoot","Utopia"],i=["North","South","East","West","Old","Little"],j="{North|South|East|West} Fork of the",k=new c(b.identity,!1);k.add("rare",function(a){return b.format("{0} {1}",b.select(i),b.select(f[a]))}),k.add("rare",function(a){return b.format("{0} {1} {2}",d(location),e(),b.select(f[a]))}),k.add("rare",function(a){return b.format("{0} {1} {2}",d(location),b.select(g),b.select(f[a]))}),k.add("rare",function(a){var c=b.test(50)?b.select(g):e();return b.format("{0} Trail {1}",c,b.select(f[a]))}),k.add("rare",function(){return b.select(h)}),k.add("common",function(a){return b.format("{0} {1}",b.select(g),b.select(f[a]))}),k.add("common",function(a){var c=e();return b.format("{0} {1}",c,b.select(f[a]))});var l=b.keys(f);a.createPlaceName=function(a){if(-1===l.indexOf(a))a=b.select(l);else if(-1===l.indexOf(a))throw new Error("Unsupported place name type, try: "+l.join(", "));return b.random(b.select(k.get()(a)))},a.getLandformTypes=function(){return l}}(atomic,ion,ion.tables.RarityTable),function(a,b,c){averages=[{lo:34,hi:61,mn:48,rain:1},{lo:40,hi:69,mn:54,rain:1},{lo:46,hi:74,mn:60,rain:1},{lo:53,hi:83,mn:68,rain:1},{lo:61,hi:93,mn:77,rain:0},{lo:70,hi:103,mn:86,rain:0},{lo:77,hi:109,mn:93,rain:2},{lo:75,hi:107,mn:92,rain:2},{lo:68,hi:100,mn:84,rain:2},{lo:55,hi:87,mn:71,rain:0},{lo:43,hi:73,mn:57,rain:1},{lo:34,hi:62,mn:48,rain:1}],months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],a.createWeather=function(a){var d=b.isUndefined(a)?(new Date).getMonth():months.indexOf(a.toLowerCase()),e=averages[d],f=new c({low:e.lo+b.roll("1d10-5"),high:e.hi+b.roll("1d10-5"),rain:"clear skies"});return 0===e.rain&&b.test(8)?f.rain=b.select(["cloudy skies","high clouds"]):1===e.rain&&b.test(10)?f.rain=b.select(["light rain","strong winds"]):2===e.rain&&b.test(10)&&(f.rain="thunderstorms"),f}}(atomic,ion,ion.models.Weather),function(a,b,c){function d(){return b.test(90)?j.get()+k.get():b.random(i)+" "+b.random(h)}var e="{Alpha|American|North American|National|General|Universal|International|Consolidated|Central|Western|Eastern|Union}",f="{Micro|Radiation|Nuclear|Atomic|Radium|Uranium|Plutonium|Development|X-Ray|Gamma Ray}",g="{Engineering|Research|Scientific|Electronics|Instruments|Devices}",h="{Laboratory|Laboratories|Corporation|Supply Company|Company|Foundation|Inc.}",i=["Raytomic","Detectron","Gamma-O-Meter","Librascope","Micromatic","Micro Devices","Micro Specialties","Radiaphone","Radiometric","Ra-Tektor","Nucleonics","Scintillonics","Tracerlab"],j=new c(b.transform);j.add(70,function(){return b.random(e)+" "+b.random(f)}),j.add(15,function(){return a.createCharacterName({race:"anglo"}).family+" "+b.random(f)}),j.add(15,function(){return a.createCharacterName({race:"anglo"}).family});var k=new c(b.transform);k.add(25,function(){return" "+b.random(g)}),k.add(25,function(){return" "+b.random(h)}),k.add(50,function(){return" "+b.random(g)+" "+b.random(h)}),a.createCorporateName=function(){for(var a=d();a.split(" ").length>4;)console.log("Too long",a),a=d();return a}}(atomic,ion,ion.tables.Table),function(a,b,c,d){var e={settlement:["General Store","Shop","Store","Market","Mercantile","Trading Post"]},f=new d;f.add(50,function(){return a.createPlaceName()+" "+b.random(e.settlement)}),f.add(10,function(a){return a+/[sz]$/.test(a)?"'":"'s",a+" "+b.random(e.settlement)}),f.add(40,function(a){for(var c=b.random(e.settlement);"Shop"===c;)c=b.random(e.settlement);return a+" "+c});var g=new d;g.add(20,function(b){return a.createRelationship({profession:"trader",familyName:b})}),g.add(65,function(b){var c=a.createCharacterName({family:b});return a.createCharacter({profession:"trader",name:c})}),g.add(15,function(b){var c=a.createCharacterName({family:b}),d=a.createCharacter({profession:"trader",name:c});return a.assignNickname(d),d}),a.createStore=function(d){var e=a.createCharacterName();d=d||{},d.name=d.name||f.get()(e.family),d.owner=d.owner||g.get()(e.family),d.totalValue=d.totalValue||20;var h=a.createBag({tags:"fresh food",fillBag:!1,totalValue:d.totalValue});h.entries.forEach(function(a){if(a.count<2&&a.item.not("luxury")&&a.item.not("rare")){var c=2*b.roll("1d3")*(4-(a.item.value+"").length);h.add(a.item,c)}});var i=a.createContainer("Currency on hand");return new c({name:d.name||f.get()(e),owner:d.owner||g.get()(e),inventory:h,onhand:i})}}(atomic,ion,ion.models.Store,ion.tables.Table,ion.models.Name),function(a,b,c,d,e){function f(){return 18+b.nonNegativeGaussian(7)}function g(c,e){var f=c.male?"female":"male",g=a.createRace(),h=new b.models.Character({name:a.createCharacterName({gender:f,race:g}),race:g,profession:m(c.profession),gender:f,age:b.bounded(c.age+b.gaussian(3),18)});e.push(h);var i=new d({parent:c,other:h,relationship:"couple"});return c.family=h.family=i,b.test(80)&&(i.relationship="married",b.test(90)&&(i.female.name.family=i.male.name.family)),i}function h(){return b.nonNegativeGaussian(2.5,1)||h()}function i(a,c){var d=h();if(a.female.age<40){for(var e=0;d>e;e++)j(a,c);var f=b.nonNegativeGaussian(4,1);l(c,f)}}function j(c,d){var e=b.random(["male","female"]),f=new b.models.Character({name:a.createCharacterName({gender:e,race:c.female.race}),race:c.female.race,gender:e,age:b.roll("1d3")});d.push(f),f.name.family=c.male.name.family,l(d,f.age+b.roll("1d3-1")),c.children.push(f),f.family=c}function k(a,c){var d=b.random(a.children);if(!d)throw new Error("No child in this family");var e=f();return d.age>=e?d:(l(c,e-d.age),d)}function l(a,b){a.forEach(function(a){a.age+=b})}function m(a){var d=b.intersection(["high","low","normal"],c.find(b.toTag(a)).tags);return b.test(40)?a:c.find(d+" -pre -innate").names[0]}function n(c){c.forEach(function(d){var e=a.createCharacter({name:d.name,profession:m(c[0].profession),age:d.age,gender:d.gender,equip:!1});b.extend(d,e);var f=d.family;delete d.family,f.isParent(d)?b.test(Math.sqrt(d.age))?(d.status="absent",f.relationship="married"===f.relationship?"divorced":"separated"):b.test(Math.sqrt(d.age))&&(d.status="deceased",f.relationship=f.male===d?"widow":"widower"):b.test(Math.sqrt(d.age))&&(d.status="deceased")})}function o(a,b,c,d){if(i(a,b),d-1>c){var e=k(a,b);parents=[e],parents.forEach(function(e){var f=g(e,b);a.couples.push(f),a.children.splice(a.children.indexOf(e),1),o(f,b,c+1,d)})}}c.find("innate");var p={grandmother:{g:"female",a:0,r:["grandson","granddaughter"],n:25},grandfather:{g:"male",a:0,r:["grandson","granddaughter"],n:25},aunt:{g:"female",a:1,r:["niece","nephew"],n:50},uncle:{g:"male",a:1,r:["niece","nephew"],n:50},mother:{g:"female",a:1,r:["son","daughter"],n:80},father:{g:"male",a:1,r:["son","daughter"],n:100},brother:{g:"male",a:2,r:["sister","brother"],n:100},sister:{g:"female",a:2,r:["sister","brother"],n:100},cousin:{g:null,a:2,r:["cousin"],n:25},niece:{g:"female",a:2,r:["aunt","uncle"]},nephew:{g:"male",a:2,r:["aunt","uncle"]},son:{g:"male",a:2,r:["mother","father"]},daughter:{g:"female",a:2,r:["mother","father"]},grandson:{g:"male",a:2,r:["grandmother","grandfather"]},granddaughter:{g:"female",a:2,r:["grandmother","grandfather"]}},q=[];for(var r in p)p[r].name=r,q.push(b.titleCase(r));var s=(new e).add("common",p.mother).add("common",p.father).add("common",p.brother).add("common",p.sister).add("uncommon",p.aunt).add("uncommon",p.uncle).add("uncommon",p.cousin).add("rare",p.grandmother).add("rare",p.grandfather);a.createFamily=function(b){b=b||{},b.generations=b.generations||2,b.parent=b.parent||{},b.parent.age=b.parent.age||f();var c=a.createCharacter(b.parent),d=[c],e=g(c,d),h=e;return b.generations>1&&o(e,d,1,b.generations),n(d),h},a.getRelationships=function(){return q.sort()},a.createRelationship=function(c){c=c||{};var d,e,g=c.older?p[c.older.toLowerCase()]:s.get(),h=p[b.random(g.r)],i=Math.abs(g.a-h.a);do{d=f(),e=f();for(var j=0;i>j;j++)e+=f()}while(i>0&&18*i>e-d);var k=a.createCharacter({age:e,gender:g.g,profession:c.profession}),l=a.createCharacter({age:d,race:b.test(g.n)?k.race:a.createRace(),gender:h.g,profession:c.profession}),m=g===h?g.name+"s":g.name+" and "+h.name;return c.familyName&&(k.name.family=c.familyName),b.test(g.n)&&(l.name.family=k.name.family),new b.models.Relationship(k,l,m)}}(atomic,ion,ion.profDb,ion.models.Family,ion.tables.RarityTable),function(a){function b(a,b){if(b){var c=a.id.split("-")[0],d=a.querySelectorAll(".card > div");o.call(d,function(a){a.style.display=a.id===b?"block":"none"});var e=document.querySelector("#tabbar ."+c+" select");e&&(e.value=b)}}function c(a,c){l.className=a,m.className=a,o.call(n,function(d){d.id===a+"-card"?(d.style.display="block",b(d,c)):d.style.display="none"})}function d(){return["January","February","March","April","May","June","July","August","September","October","November","December"]}function e(a,b,c){c&&"either"!==c.toLowerCase()&&"any"!==c.toLowerCase()&&(a[b]=c)}function f(){return["Any","Soldier"].concat(a.without(window.c_profs,"Air Force","Marine","Army","Navy","Coast Guard")).sort()}function g(a,b){a=new a;var c=document.querySelector(b);ko.applyBindings(a,c)}var h="ontouchstart"in document.documentElement,i=h?"touchstart":"mousedown",j=h?"touchend":"mouseup",k=["Critical Failure (No, and...)","Critical Failure (No, and...)","Critical Failure (No, and...)","Failure (No)","Failure (No)","Failure (No, but...)","Failure (No, but...)","Success (Yes, but...)","Success (Yes, but...)","Success (Yes, but...)","Success (Yes)","Success (Yes)","Critical Success (Yes, and...)"];radio("message").subscribe(function(a){humane.log(a)}),ko.bindingHandlers.tap={init:function(a,b,c,d){ko.utils.registerEventHandler(a,i,function(a){a.preventDefault()}),ko.utils.registerEventHandler(a,j,function(a){a.preventDefault();var c=b();handlerReturnValue=c.call(d,d,a)})}};var l=document.querySelector("#tabs"),m=document.querySelector("#tabbar"),n=document.querySelectorAll(".card"),o=Array.prototype.forEach;o.call(n,function(a){var c=a.querySelector("div:first-child").id;b(a,c)});var p=a.define({init:function(a){this.element=a,this.closed=!0,this.toggle=this.toggle.bind(this)},toggle:function(){this.closed?(window.scrollTo(0,1),this.element.classList.add("panelOpen"),this.closed=!1):(this.element.classList.remove("panelOpen"),this.closed=!0)},close:function(){this.element.classList.remove("panelOpen"),this.closed=!0}}),q=a.define({init:function(){},tab:function(a,b){c(b.target.className)},changeSection:function(a,b){document.getElementById(b.target.parentNode.className+"-card");var d=b.target.value.toLowerCase();c(b.target.parentNode.className,d),b.target.blur()},swapSection:function(a,b){for(var d=b.target.textContent.toLowerCase(),e=b.target.parentNode.parentNode.querySelectorAll("li"),f=0;f<e.length;f++){var g=e[f];g.classList.toggle("selected",g.classList.contains(d))}c("history",d)}}),r=a.define({init:function(){var a=new Date;a.setFullYear(1965),this.date=a.toLocaleDateString()},today:function(){return this.date},weather:function(){var a=localStorage.getItem(this.date);return a||(a=atomic.createWeather().toString().toLowerCase(),localStorage.setItem(this.date,a)),a}}),s=a.define({init:function(a){this.panel=new p(document.querySelector("#"+a+"_panel")),this.output="<p>No "+a+" created yet.</p>",this.type=a,ko.track(this,["output"])},create:function(){this.panel.close(),this.output="<p>Working...</p>",setTimeout(function(){this.model=this.makeCall();var b=a.isString(this.model),c=b?this.model:this.model.toHTML(),d=b?this.model:this.model.toString();this.output=c,radio("history").broadcast({type:this.type,text:d}),window.scrollTo(0,1)}.bind(this),1)},makeCall:function(){throw new Error("create() must be subclassed.")},save:function(){if(this.model){var b=a.isString(this.model)?this.model:this.model.toString();radio("save").broadcast({type:this.type,text:b}),radio("message").broadcast("Saved "+this.type)}this.model=null}}),t=a.define(s,{init:function(){s.call(this,"character"),this.genders=["Either","Male","Female"],this.selectedGender="Either",this.professions=f(),this.selectedProfessions="Any",ko.track(this,["genders","selectedGender","professions","selectedProfession"])},makeCall:function(){var a={};return e(a,"gender",this.selectedGender.toLowerCase()),e(a,"profession",this.selectedProfession.toLowerCase()),atomic.createCharacter(a)}}),u=a.define(s,{init:function(){s.call(this,"encounter")},makeCall:function(){return atomic.createEncounter()}}),v=a.define(s,{init:function(){s.call(this,"gang"),this.gangTypes=["Any"].concat(atomic.getGangTypes()),this.selectedType="Any",this.count="",ko.track(this,["gangTypes","selectedType","count"])},makeCall:function(){var a={};return e(a,"kind",this.selectedType.toLowerCase()),/^\d+$/.test(this.count)&&(a.count=parseInt(this.count,10)),atomic.createGang(a)}}),w=a.define(s,{init:function(){s.call(this,"loot"),this.locations=["Any"].concat(window.c_locations),this.selectedLocation="Any",this.professions=f(),this.selectedProfession="Any",this.totalValue=20,ko.track(this,["locations","selectedLocation","professions","selectedProfession","totalValue"])},onChange:function(a,b){var c=b.target.name;["selectedLocation","selectedProfession"].forEach(function(a){a!==c&&(this[a]="Any")},this)},makeCall:function(){(this.totalValue<1||this.totalValue>500)&&(this.totalValue=20,radio("message").broadcast("Value out of range, using the default value of 20."));var a={},b=[];return"Any"!==this.selectedLocation?b.push(this.selectedLocation.toLowerCase()):"Any"!==this.selectedProfession&&b.push("kit:"+ion.toTag(this.selectedProfession)),b.length&&(a.tags=[b.join(" ")]),a.totalValue=parseInt(this.totalValue,10),alert(JSON.stringify(a)),atomic.createBag(a)}}),x=a.define(s,{init:function(){s.call(this,"container"),this.containers=["Any"].concat(atomic.getContainerTypes()),this.selectedContainer="Any",ko.track(this,["containers","selectedContainer"])},makeCall:function(){var b=this.selectedContainer;return"Any"===b&&(b=a.random(atomic.getContainerTypes())),atomic.createContainer(b)}}),y=a.define(s,{init:function(){s.call(this,"store")},makeCall:function(){return atomic.createStore()}}),z=a.define(s,{init:function(){s.call(this,"weather"),this.months=d(),this.selectedMonth=d()[(new Date).getMonth()],ko.track(this,["months","selectedMonth"])},makeCall:function(){return atomic.createWeather(this.selectedMonth.substring(0,3))}}),A=a.define(s,{init:function(){s.call(this,"corporation"),ko.track(this)},makeCall:function(){return atomic.createCorporateName()}}),B=a.define(s,{init:function(){s.call(this,"town");var b=atomic.getLandformTypes().map(a.sentenceCase);this.geographies=["Any"].concat(b),this.selectedGeography="Any",ko.track(this,["geographies","selectedGeography"])},makeCall:function(){return atomic.createPlaceName(this.selectedGeography.toLowerCase())}}),C=a.define(s,{init:function(){s.call(this,"family"),this.professions=f(),this.selectedProfession="Any",this.generations=[1,2,3,4],this.selectedGeneration=2,ko.track(this,["professions","generations","selectedGeneration","selectedProfession"])},makeCall:function(){var a={};return e(a,"profession",this.selectedProfession),atomic.createFamily({generations:parseInt(this.selectedGeneration,10),parent:a})}}),D=a.define(s,{init:function(){s.call(this,"relationship"),this.relationships=["Any"].concat(atomic.getRelationships()),this.selectedRelation="Any",this.professions=f(),this.selectedProfessions="Any",ko.track(this,["relationships","selectedRelation","professions","selectedProfession"])},makeCall:function(){var a={};return e(a,"older",this.selectedRelation),e(a,"profession",this.selectedProfession),atomic.createRelationship(a)}}),E=a.define({init:function(){this.container=document.querySelector(".well.dice"),this.mod=0,this.output="",this.descr="",ko.track(this,["mod","output","descr"])},setMod:function(a,b){[].slice.call(b.target.parentNode.parentNode.querySelectorAll(".btn")).forEach(function(a){a.classList.remove(a.getAttribute("data-active"))}),b.target.classList.add(b.target.getAttribute("data-active")),this.mod=parseInt(b.target.textContent,10)},roll:function(){if(!this.locked){var b=a.roll(6),c=a.roll(6),d=b+c+this.mod,e=0!==this.mod?a.format("{0} + {1} + {2} = {3}",b,c,this.mod,d):a.format("{0} + {1} = {2}",b,c,d),f=k[a.bounded(d,0,12)];this.updateUI(e,f)}},combatRoll:function(){if(!this.locked){var b=a.roll(6),c=a.roll(6),d=b+c+this.mod,e=0!==this.mod?a.format("{0} + {1} + {2} = {3}",b,c,this.mod,d):a.format("{0} + {1} = {2}",b,c,d),f=null;f=1===b&&b===c?"Critical Miss":6===b&&b===c?"Critical Hit":d>=7?"Hit":"Miss",b===c&&1!==b&&6!==b&&(f+=" (Use "+b+"x ammo)"),this.updateUI(e,f)}},updateUI:function(a,b){this.locked=!0,this.container.classList.add("bounceIn"),this.output=a,this.descr=b,radio("history").broadcast({type:"dice",text:a+": "+b}),setTimeout(function(){this.container.classList.remove("bounceIn"),this.locked=!1}.bind(this),1100)}}),F=a.define({init:function(){radio("history").subscribe(this.addToHistory.bind(this)),radio("save").subscribe(this.addToSaved.bind(this));var a=JSON.parse(localStorage.getItem("history"))||{};this.historyItems=a.historyItems||[],this.savedItems=a.savedItems||[],ko.track(this,["historyItems","savedItems"])},persist:function(a){localStorage.setItem("history",JSON.stringify(a))},addToHistory:function(a){for(;this.historyItems.length>=20;)this.historyItems.pop();this.historyItems.unshift(a.text),this.persist(ko.toJS(this))},addToSaved:function(a){this.savedItems.unshift(a.text),this.persist(ko.toJS(this))},save:function(a,b){var c=ko.contextFor(b.target).$parent;-1===c.savedItems.indexOf(a)?(c.historyItems.remove(a),c.addToSaved({type:"",text:a}),radio("message").broadcast("Saved")):radio("message").broadcast("Already saved")},remove:function(a,b){if(confirm("Are you sure?")){var c=ko.contextFor(b.target).$parent;c.savedItems.remove(a),c.persist(ko.toJS(c))}},removeHistory:function(a,b){if(confirm("Are you sure?")){var c=ko.contextFor(b.target).$parent;c.historyItems.remove(a),c.persist(ko.toJS(c))}},email:function(a){document.location="mailto:?subject="+encodeURIComponent("Data from The Codex")+"&body="+encodeURIComponent(a)}});window.addEventListener("load",function(){g(q,"#tabgroup"),g(r,"#rules-card"),g(t,"#character"),g(u,"#encounter"),g(v,"#gang"),g(w,"#loot"),g(x,"#container"),g(z,"#weather"),g(B,"#town"),g(A,"#corporation"),g(C,"#family"),g(D,"#relationship"),g(y,"#store"),g(E,"#dice-card"),g(F,"#history-card","history"),c("builders","store"),setTimeout(function(){document.body.style.opacity=1},200)},!0)}(ion);